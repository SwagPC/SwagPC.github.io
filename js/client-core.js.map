{"version":3,"sources":["../src/client-core.ts"],"names":["Array","prototype","indexOf","searchElement","fromIndex","i","length","includes","thing","String","startsWith","slice","endsWith","trim","replace","Object","assign","rest","arguments","source","k","create","proto","F","window","console","log","PSURL","document","location","protocol","Config","routes","client","PSSubscription","observable","listener","unsubscribe","index","subscriptions","splice","PSModel","subscribe","subscription","push","subscribeAndRun","update","PSStreamModel","updates","value","PSBackground","id","curId","attrib","changeCount","menuColors","bg","localStorage","getItem","split","set","save","bgUrl","setItem","join","bgid","host","bgs","Math","floor","random","url","title","artist","charAt","r","parseInt","g","b","hs","getHueSat","extractMenuColors","img","Image","onload","colorThief","ColorThief","colors","getPalette","color","unshift","src","max","min","l","d","s","h","body","style","background","backgroundSize","buttonStyleElem","getElementById","textContent","cssBuf","n","HTMLStyleElement","head","appendChild"],"mappings":"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","sourcesContent":["/**\n * Client core\n *\n * No dependencies.\n * Does three unrelated things:\n * 1. sets up polyfills where necessary\n * 2. sets up PS's model base classes\n * 3. sets up the model and view for PS's backgrounds\n *\n * The background is mostly here so the new background can be loaded ASAP.\n *\n * @author Guangcong Luo <guancongluo@gmail.com>\n * @license AGPLv3\n */\n\n/**********************************************************************\n * Polyfills\n *********************************************************************/\n\nif (!Array.prototype.indexOf) {\n\tArray.prototype.indexOf = function (searchElement, fromIndex) {\n\t\tfor (let i = (fromIndex || 0); i < this.length; i++) {\n\t\t\tif (this[i] === searchElement) return i;\n\t\t}\n\t\treturn -1;\n\t};\n}\nif (!Array.prototype.includes) {\n\tArray.prototype.includes = function (thing) {\n\t\treturn this.indexOf(thing) !== -1;\n\t};\n}\nif (!String.prototype.includes) {\n\tString.prototype.includes = function (thing) {\n\t\treturn this.indexOf(thing) !== -1;\n\t};\n}\nif (!String.prototype.startsWith) {\n\tString.prototype.startsWith = function (thing) {\n\t\treturn this.slice(0, thing.length) === thing;\n\t};\n}\nif (!String.prototype.endsWith) {\n\tString.prototype.endsWith = function (thing) {\n\t\treturn this.slice(-thing.length) === thing;\n\t};\n}\nif (!String.prototype.trim) {\n\tString.prototype.trim = function () {\n\t\treturn this.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n\t};\n}\nif (!Object.assign) {\n\tObject.assign = function (thing: any, rest: any) {\n\t\tfor (let i = 1; i < arguments.length; i++) {\n\t\t\tlet source = arguments[i];\n\t\t\tfor (let k in source) {\n\t\t\t\tthing[k] = source[k];\n\t\t\t}\n\t\t}\n\t\treturn thing;\n\t};\n}\nif (!Object.create) {\n\tObject.create = function (proto: any) {\n\t\tfunction F() {}\n\t\tF.prototype = proto;\n\t\treturn new (F as any)();\n\t};\n}\nif (!window.console) {\n\t// in IE8, the console object is only defined when devtools is open\n\t// I don't actually know if this will cause problems when you open devtools,\n\t// but that's something I can figure out if I ever bother testing in IE8\n\t(window as any).console = {\n\t\tlog() {},\n\t};\n}\n\n/**********************************************************************\n * PS Models\n *********************************************************************/\n// PS's model classes are defined here\n\nconst PSURL = `${document.location!.protocol !== 'http:' ? 'https:' : ''}//${Config.routes.client}/`;\n\nclass PSSubscription {\n\tobservable: PSModel | PSStreamModel<any>;\n\tlistener: (value?: any) => void;\n\tconstructor(observable: PSModel | PSStreamModel<any>, listener: (value?: any) => void) {\n\t\tthis.observable = observable;\n\t\tthis.listener = listener;\n\t}\n\tunsubscribe() {\n\t\tconst index = this.observable.subscriptions.indexOf(this);\n\t\tif (index >= 0) this.observable.subscriptions.splice(index, 1);\n\t}\n}\n\n/**\n * PS Models roughly implement the Observable spec. Not the entire\n * spec - just the parts we use. PSModel just notifies subscribers of\n * updates - a simple model for React.\n */\nclass PSModel {\n\tsubscriptions = [] as PSSubscription[];\n\tsubscribe(listener: () => void) {\n\t\tconst subscription = new PSSubscription(this, listener);\n\t\tthis.subscriptions.push(subscription);\n\t\treturn subscription;\n\t}\n\tsubscribeAndRun(listener: () => void) {\n\t\tconst subscription = this.subscribe(listener);\n\t\tsubscription.listener();\n\t\treturn subscription;\n\t}\n\tupdate() {\n\t\tfor (const subscription of this.subscriptions) {\n\t\t\tsubscription.listener();\n\t\t}\n\t}\n}\n\n/**\n * PS Models roughly implement the Observable spec. PSStreamModel\n * streams some data out. This is very not-React, which generally\n * expects the DOM to be a pure function of state. Instead PSModels\n * which hold state, PSStreamModels give state directly to views,\n * so that the model doesn't need to hold a redundant copy of state.\n */\nclass PSStreamModel<T = string> {\n\tsubscriptions = [] as PSSubscription[];\n\tupdates = [] as T[];\n\tsubscribe(listener: (value: T) => void) {\n\t\t// TypeScript bug\n\t\tconst subscription: PSSubscription = new PSSubscription(this, listener);\n\t\tthis.subscriptions.push(subscription);\n\t\tif (this.updates.length) {\n\t\t\tfor (const update of this.updates) {\n\t\t\t\tsubscription.listener(update);\n\t\t\t}\n\t\t\tthis.updates = [];\n\t\t}\n\t\treturn subscription;\n\t}\n\tsubscribeAndRun(listener: (value: T) => void) {\n\t\tconst subscription = this.subscribe(listener);\n\t\tsubscription.listener(null);\n\t\treturn subscription;\n\t}\n\tupdate(value: T) {\n\t\tif (!this.subscriptions.length) {\n\t\t\t// save updates for later\n\t\t\tthis.updates.push(value);\n\t\t}\n\t\tfor (const subscription of this.subscriptions) {\n\t\t\tsubscription.listener(value);\n\t\t}\n\t}\n}\n\n// type JSONObject = {[k: string]: JSONValue};\n// type JSONArray = JSONValue[];\n// type JSONValue = number | string | boolean | null | JSONObject | JSONArray;\n\n/**********************************************************************\n * Background Model\n *********************************************************************/\n\ndeclare const ColorThief: any;\n\n/**\n * PS background model. Separate from PSPrefs because unlike prefs,\n * backgrounds can be set separately per server, instead of being\n * shared among all servers.\n *\n * Streams the current URL\n */\nconst PSBackground = new class extends PSStreamModel {\n\tid = '';\n\tcurId = '';\n\tattrib: {url: string, title: string, artist: string} | null = null;\n\tchangeCount = 0;\n\tmenuColors: string[] | null = null;\n\n\tconstructor() {\n\t\tsuper();\n\t\ttry {\n\t\t\tlet bg = localStorage.getItem('showdown_bg')!.split('\\n');\n\t\t\tif (bg.length === 1) {\n\t\t\t\tthis.set('', bg[0]);\n\t\t\t} else if (bg.length === 2) {\n\t\t\t\tthis.set(bg[0], bg[1]);\n\t\t\t} else if (bg.length >= 7) {\n\t\t\t\tthis.set(bg[0], bg[1], bg.slice(2));\n\t\t\t}\n\t\t} catch {}\n\t}\n\tsave(bgUrl: string) {\n\t\tif (this.id !== 'custom') {\n\t\t\tlocalStorage.setItem('showdown_bg', this.id);\n\t\t} else if (this.menuColors) {\n\t\t\tlocalStorage.setItem('showdown_bg', bgUrl + '\\n' + this.id + '\\n' + this.menuColors.join('\\n'));\n\t\t}\n\t}\n\n\tset(bgUrl: string, bgid: string, menuColors: string[] | null = null) {\n\t\t// id\n\t\tthis.id = bgid;\n\n\t\t// curid\n\t\tif (!bgid) {\n\t\t\tif (location.host === 'smogtours.psim.us') {\n\t\t\t\tbgid = 'shaymin';\n\t\t\t} else if (location.host === Config.routes.client) {\n\t\t\t\tconst bgs = ['horizon', 'ocean', 'waterfall', 'shaymin', 'charizards'];\n\t\t\t\tbgid = bgs[Math.floor(Math.random() * 5)];\n\t\t\t\tif (bgid === this.curId) bgid = bgs[Math.floor(Math.random() * 5)];\n\t\t\t}\n\t\t}\n\t\tthis.curId = bgid;\n\n\t\tif (!bgUrl) {\n\t\t\tbgUrl = (bgid === 'solidblue' ? '#344b6c' : PSURL + 'fx/client-bg-' + bgid + '.jpg');\n\t\t}\n\n\t\t// April Fool's 2016 - Digimon theme\n\t\t// bgid = 'digimon';\n\t\t// bgUrl = PSURL + 'sprites/afd/digimonbg.jpg';\n\n\t\tthis.changeCount++;\n\n\t\t// menuColors, attrib\n\t\tlet attrib = null;\n\t\tswitch (bgid) {\n\t\tcase 'horizon':\n\t\t\tmenuColors = [\n\t\t\t\t\"318.87640449438203,35.177865612648226%\",\n\t\t\t\t\"216,46.2962962962963%\",\n\t\t\t\t\"221.25,32.25806451612904%\",\n\t\t\t\t\"197.8021978021978,52.60115606936417%\",\n\t\t\t\t\"232.00000000000003,19.480519480519483%\",\n\t\t\t\t\"228.38709677419354,60.7843137254902%\",\n\t\t\t];\n\t\t\tattrib = {\n\t\t\t\turl: 'https://vtas.deviantart.com/art/Pokemon-Horizon-312267168',\n\t\t\t\ttitle: 'Horizon',\n\t\t\t\tartist: 'Vivian Zou',\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'ocean':\n\t\t\tmenuColors = [\n\t\t\t\t\"82.8169014084507,34.63414634146342%\",\n\t\t\t\t\"216.16438356164383,29.55465587044534%\",\n\t\t\t\t\"212.92682926829266,59.42028985507245%\",\n\t\t\t\t\"209.18918918918916,57.51295336787566%\",\n\t\t\t\t\"199.2857142857143,48.275862068965495%\",\n\t\t\t\t\"213.11999999999998,55.06607929515419%\",\n\t\t\t];\n\t\t\tattrib = {\n\t\t\t\turl: 'https://quanyails.deviantart.com/art/Sunrise-Ocean-402667154',\n\t\t\t\ttitle: 'Sunrise Ocean',\n\t\t\t\tartist: 'Yijing Chen',\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'waterfall':\n\t\t\tmenuColors = [\n\t\t\t\t\"119.31034482758622,37.66233766233767%\",\n\t\t\t\t\"184.36363636363635,23.012552301255226%\",\n\t\t\t\t\"108.92307692307692,37.14285714285714%\",\n\t\t\t\t\"70.34482758620689,20.567375886524818%\",\n\t\t\t\t\"98.39999999999998,36.76470588235296%\",\n\t\t\t\t\"140,38.18181818181818%\",\n\t\t\t];\n\t\t\tattrib = {\n\t\t\t\turl: 'https://yilx.deviantart.com/art/Irie-372292729',\n\t\t\t\ttitle: 'Irie',\n\t\t\t\tartist: 'Samuel Teo',\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'shaymin':\n\t\t\tmenuColors = [\n\t\t\t\t\"39.000000000000064,21.7391304347826%\",\n\t\t\t\t\"170.00000000000003,2.380952380952378%\",\n\t\t\t\t\"157.5,11.88118811881188%\",\n\t\t\t\t\"174.78260869565216,12.041884816753928%\",\n\t\t\t\t\"185.00000000000003,12.76595744680851%\",\n\t\t\t\t\"20,5.660377358490567%\",\n\t\t\t];\n\t\t\tattrib = {\n\t\t\t\turl: 'http://cargocollective.com/bluep',\n\t\t\t\ttitle: 'Shaymin',\n\t\t\t\tartist: 'Daniel Kong',\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'charizards':\n\t\t\tmenuColors = [\n\t\t\t\t\"37.159090909090914,74.57627118644066%\",\n\t\t\t\t\"10.874999999999998,70.79646017699115%\",\n\t\t\t\t\"179.51612903225808,52.10084033613446%\",\n\t\t\t\t\"20.833333333333336,36.73469387755102%\",\n\t\t\t\t\"192.3076923076923,80.41237113402063%\",\n\t\t\t\t\"210,29.629629629629633%\",\n\t\t\t];\n\t\t\tattrib = {\n\t\t\t\turl: 'https://seiryuuden.deviantart.com/art/The-Ultimate-Mega-Showdown-Charizards-414587079',\n\t\t\t\ttitle: 'Charizards',\n\t\t\t\tartist: 'Jessica Valencia',\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'digimon':\n\t\t\tmenuColors = [\n\t\t\t\t\"170.45454545454544,27.500000000000004%\",\n\t\t\t\t\"84.70588235294119,13.821138211382115%\",\n\t\t\t\t\"112.50000000000001,7.8431372549019605%\",\n\t\t\t\t\"217.82608695652175,54.761904761904766%\",\n\t\t\t\t\"0,1.6949152542372816%\",\n\t\t\t\t\"\",\n\t\t\t];\n\t\t}\n\t\tif (!menuColors && bgUrl.charAt(0) === '#') {\n\t\t\tconst r = parseInt(bgUrl.slice(1, 3), 16) / 255;\n\t\t\tconst g = parseInt(bgUrl.slice(3, 5), 16) / 255;\n\t\t\tconst b = parseInt(bgUrl.slice(5, 7), 16) / 255;\n\t\t\tconst hs = this.getHueSat(r, g, b);\n\t\t\tmenuColors = [hs, hs, hs, hs, hs, hs];\n\t\t}\n\t\tthis.attrib = attrib;\n\t\tthis.menuColors = menuColors;\n\t\tif (!menuColors) {\n\t\t\tthis.extractMenuColors(bgUrl);\n\t\t} else {\n\t\t\tthis.save(bgUrl);\n\t\t}\n\t}\n\textractMenuColors(bgUrl: string) {\n\t\tconst changeCount = this.changeCount;\n\t\t// We need the image object to load it on a canvas to detect the main color.\n\t\tconst img = new Image();\n\t\timg.onload = () => {\n\t\t\tif (changeCount === PSBackground.changeCount) return;\n\t\t\t// in case ColorThief throws from canvas,\n\t\t\t// or localStorage throws\n\t\t\ttry {\n\t\t\t\tconst colorThief = new ColorThief();\n\t\t\t\tconst colors = colorThief.getPalette(img, 5);\n\n\t\t\t\tlet menuColors = [];\n\t\t\t\tif (!colors) {\n\t\t\t\t\tmenuColors = ['0, 0%', '0, 0%', '0, 0%', '0, 0%', '0, 0%'];\n\t\t\t\t} else {\n\t\t\t\t\tfor (let i = 0; i < 5; i++) {\n\t\t\t\t\t\tconst color = colors[i];\n\t\t\t\t\t\tconst hs = PSBackground.getHueSat(color[0] / 255, color[1] / 255, color[2] / 255);\n\t\t\t\t\t\tmenuColors.unshift(hs);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.menuColors = menuColors;\n\t\t\t\tPSBackground.save(bgUrl);\n\t\t\t} catch {}\n\t\t};\n\t\timg.src = bgUrl;\n\t}\n\tgetHueSat(r: number, g: number, b: number) {\n\t\tconst max = Math.max(r, g, b);\n\t\tconst min = Math.min(r, g, b);\n\t\tif (max === min) {\n\t\t\treturn `0,0%`;\n\t\t}\n\t\tconst l = (max + min) / 2;\n\t\tconst d = max - min;\n\t\tconst s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\t\tlet h = 0;\n\t\tswitch (max) {\n\t\tcase r: h = (g - b) / d + (g < b ? 6 : 0); break;\n\t\tcase g: h = (b - r) / d + 2; break;\n\t\tcase b: h = (r - g) / d + 4; break;\n\t\t}\n\t\th /= 6;\n\t\treturn `${h * 360},${s * 100}%`;\n\t}\n};\n\n/**********************************************************************\n * Core Views\n *********************************************************************/\n\nPSBackground.subscribe(bgUrl => {\n\tif (!PSBackground.curId) {\n\t\tdocument.body.style.background = '';\n\t\tdocument.body.style.backgroundSize = '';\n\t\tconst buttonStyleElem = document.getElementById('mainmenubuttoncolors');\n\t\tif (buttonStyleElem) buttonStyleElem.textContent = ``;\n\t\treturn;\n\t}\n\n\tif (bgUrl !== null) {\n\t\tlet background;\n\t\tif (bgUrl.charAt(0) === '#') {\n\t\t\tbackground = bgUrl;\n\t\t} else if (PSBackground.curId !== 'custom') {\n\t\t\tbackground = `#546bac url(${bgUrl}) no-repeat left center fixed`;\n\t\t} else {\n\t\t\tbackground = `#546bac url(${bgUrl}) no-repeat center center fixed`;\n\t\t}\n\t\tdocument.body.style.background = background;\n\t\tdocument.body.style.backgroundSize = 'cover';\n\t}\n\n\t// main menu button colors\n\tlet cssBuf = ``;\n\tlet n = 0;\n\tif (PSBackground.menuColors) {\n\t\tfor (const hs of PSBackground.menuColors) {\n\t\t\tn++;\n\t\t\tcssBuf += `body .button.mainmenu${n} { background: linear-gradient(to bottom,  hsl(${hs},72%),  hsl(${hs},52%)); border-color: hsl(${hs},40%); }\\n`;\n\t\t\tcssBuf += `body .button.mainmenu${n}:hover { background: linear-gradient(to bottom,  hsl(${hs},62%),  hsl(${hs},42%)); border-color: hsl(${hs},21%); }\\n`;\n\t\t\tcssBuf += `body .button.mainmenu${n}:active { background: linear-gradient(to bottom,  hsl(${hs},42%),  hsl(${hs},58%)); border-color: hsl(${hs},21%); }\\n`;\n\t\t}\n\t}\n\tlet buttonStyleElem = document.getElementById('mainmenubuttoncolors');\n\tif (!buttonStyleElem) {\n\t\tif (cssBuf) {\n\t\t\tbuttonStyleElem = new HTMLStyleElement();\n\t\t\tbuttonStyleElem.id = 'mainmenubuttoncolors';\n\t\t\tbuttonStyleElem.textContent = cssBuf;\n\t\t\tdocument.head!.appendChild(buttonStyleElem);\n\t\t}\n\t} else {\n\t\tbuttonStyleElem.textContent = cssBuf;\n\t}\n});\n// '<a href=\"https://vtas.deviantart.com/art/Pokemon-Horizon-312267168\" target=\"_blank\" class=\"subtle\">\"Horizon\" <small>background by Vivian Zou</small></a>';\n// if (attrib) attrib = '<small style=\"display:block;padding-bottom:4px\">' + attrib + '</small>';\n"],"file":"client-core.js"}