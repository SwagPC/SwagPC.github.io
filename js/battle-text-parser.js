var BattleTextParser=function(){function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"p1";this.p1="Player 1",this.p2="Player 2",this.p3="Player 3",this.p4="Player 4",this.p5="Player 5",this.p6="Player 6",this.p7="Player 7",this.p8="Player 8",this.perspective=void 0,this.gen=7,this.turn=0,this.curLineSection="break",this.lowercaseRegExp=void 0,this.pokemonName=function(e){return e?e.startsWith("p")?":"===e.charAt(3)?e.slice(4).trim():":"===e.charAt(2)?e.slice(3).trim():"???pokemon:"+e+"???":"???pokemon:"+e+"???":""},this.perspective=e}u.parseLine=function(e,t){if(!e.startsWith("|"))return["",e];if("|"===e)return["done"];var a=e.indexOf("|",1),r=e.slice(1,a);switch(r){case"chatmsg":case"chatmsg-raw":case"raw":case"error":case"html":case"inactive":case"inactiveoff":case"warning":case"fieldhtml":case"controlshtml":case"bigerror":case"debug":case"tier":case"challstr":case"popup":case"":return[r,e.slice(a+1)];case"c":case"chat":case"uhtml":case"uhtmlchange":case"queryresponse":var i=e.indexOf("|",a+1);return[r,e.slice(a+1,i),e.slice(i+1)];case"c:":case"pm":var i=e.indexOf("|",a+1),s=e.indexOf("|",i+1);return[r,e.slice(a+1,i),e.slice(i+1,s),e.slice(s+1)]}return t?null:e.slice(1).split("|")},u.parseBattleLine=function(e){if(t=this.parseLine(e,!0))return{args:t,kwArgs:{}};for(var t=e.slice(1).split("|"),a={};1<t.length;){var r=t[t.length-1];if("["!==r.charAt(0))break;var i=r.indexOf("]");if(i<=0)break;a[r.slice(1,i)]=r.slice(i+1).trim()||".",t.pop()}return u.upgradeArgs({args:t,kwArgs:a})},u.parseNameParts=function(e){var t="",a=(/[A-Za-z0-9]/.test(e.charAt(0))||(t=e.charAt(0),e=e.slice(1)),e),r=e.indexOf("@"),i="",s=!1;return 0<r&&(a=e.slice(0,r),(i=e.slice(r+1)).startsWith("!")&&(s=!0,i=i.slice(1))),{group:t,name:a,away:s,status:i}},u.upgradeArgs=function(e){var t=e.args,a=e.kwArgs;switch(t[0]){case"-activate":if(a.item||a.move||a.number||a.ability)return{args:t,kwArgs:a};var r=t,i=r[1],s=r[2],o=r[3],r=r[4],c=a.of,l=u.effectId(s);if(a.block)return{args:["-fail",i],kwArgs:a};if("wonderguard"===l)return{args:["-immune",i],kwArgs:{from:"ability:Wonder Guard"}};if("beatup"===l&&a.of)return{args:t,kwArgs:{name:a.of}};if(["ingrain","quickguard","wideguard","craftyshield","matblock","protect","mist","safeguard","electricterrain","mistyterrain","psychicterrain","telepathy","stickyhold","suctioncups","aromaveil","flowerveil","sweetveil","disguise","safetygoggles","protectivepads"].includes(l))return c?(a.of=i,{args:["-block",c,s,o],kwArgs:a}):{args:["-block",i,s,o],kwArgs:a};if("charge"===l)return{args:["-singlemove",i,s],kwArgs:{of:c}};if(["bind","wrap","clamp","whirlpool","firespin","magmastorm","sandtomb","infestation","snaptrap","thundercage","trapped"].includes(l))return{args:["-start",i,s],kwArgs:{of:c}};if("fairylock"===l)return{args:["-fieldactivate",s],kwArgs:{}};"symbiosis"===l||"poltergeist"===l?a.item=o:"magnitude"===l?a.number=o:"skillswap"===l||"mummy"===l||"wanderingspirit"===l?(a.ability=o,a.ability2=r):["eeriespell","gmaxdepletion","spite","grudge","forewarn","sketch","leppaberry","mysteryberry"].includes(l)&&(a.move=o,a.number=r),t=["-activate",i,s,c||""];break;case"-fail":if("ability: Flower Veil"===a.from)return{args:["-block",a.of,"ability: Flower Veil"],kwArgs:{of:t[1]}};break;case"-start":"Protean"!==a.from&&"Color Change"!==a.from||(a.from="ability:"+a.from);break;case"move":"Magic Bounce"===a.from&&(a.from="ability:Magic Bounce");break;case"cant":l=t,o=l[1],r=l[2],i=l[3];if(["ability: Queenly Majesty","ability: Damp","ability: Dazzling"].includes(r))return{args:[t[0]="-block",o,r,i,a.of],kwArgs:{}};break;case"-nothing":return{args:["-activate","","move:Splash"],kwArgs:a}}return{args:t,kwArgs:a}};var e=u.prototype;return e.extractMessage=function(e){for(var t="",a=0,r=e.split("\n");a<r.length;a++){var i=r[a],i=u.parseBattleLine(i),s=i.args,i=i.kwArgs;t+=this.parseArgs(s,i)||""}return t},e.fixLowercase=function(e){var t;return void 0===this.lowercaseRegExp&&((t=["pokemon","opposingPokemon","team","opposingTeam","party","opposingParty"].map(function(e){var t,a=BattleText.default[e];return a.charAt(0)===a.charAt(0).toUpperCase()?"":0<=(t=a.indexOf("["))?a.slice(0,t):a}).filter(function(e){return e})).length?(t="((?:^|\n)(?:  |  \\(|\\[)?)("+t.map(u.escapeRegExp).join("|")+")",this.lowercaseRegExp=new RegExp(t,"g")):this.lowercaseRegExp=null),this.lowercaseRegExp?e.replace(this.lowercaseRegExp,function(e,t,a){return t+a.charAt(0).toUpperCase()+a.slice(1)}):e},u.escapeRegExp=function(e){return e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&")},e.pokemon=function(e){var t,a;return e?(a=e.slice(0,2),["p1","p2","p3","p4"].includes(a)?(t=this.pokemonName(e),a=a===this.perspective||a===u.allyID(a),BattleText.default[a?"pokemon":"opposingPokemon"].replace("[NICKNAME]",t)):"???pokemon:"+e+"???"):""},e.pokemonFull=function(e,t){var a=this.pokemonName(e),r=t.split(",")[0];return a===r?[e.slice(0,2),"**"+r+"**"]:[e.slice(0,2),a+" (**"+r+"**)"]},e.trainer=function(e){return"p1"===(e=e.slice(0,2))?this.p1:"p2"===e?this.p2:"p3"===e?this.p3:"p4"===e?this.p4:"???side:"+e+"???"},u.allyID=function(e){return"p1"===e?"p3":"p2"===e?"p4":"p3"===e?"p1":"p4"===e?"p2":""},e.team=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return(e=e.slice(0,2))===this.perspective||e===u.allyID(e)?t?BattleText.default.opposingTeam:BattleText.default.team:t?BattleText.default.team:BattleText.default.opposingTeam},e.own=function(e){return(e=e.slice(0,2))===this.perspective?"OWN":""},e.party=function(e){return(e=e.slice(0,2))===this.perspective||e===u.allyID(e)?BattleText.default.party:BattleText.default.opposingParty},u.effectId=function(e){return e?(e.startsWith("item:")||e.startsWith("move:")?e=e.slice(5):e.startsWith("ability:")&&(e=e.slice(8)),toID(e)):""},e.effect=function(e){return e?(e.startsWith("item:")||e.startsWith("move:")?e=e.slice(5):e.startsWith("ability:")&&(e=e.slice(8)),e.trim()):""},e.template=function(e){for(var t=arguments.length,a=new Array(1<t?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];for(var i=0;i<a.length;i++){var s=a[i];if(s){if("OWN"===s)return BattleText.default[e+"Own"]+"\n";if("NODEFAULT"===s)return"";s=u.effectId(s);if(BattleText[s]&&e in BattleText[s])return"."===BattleText[s][e].charAt(1)&&(e=BattleText[s][e].slice(2)),"#"===BattleText[s][e].charAt(0)&&(s=BattleText[s][e].slice(1)),BattleText[s][e]?BattleText[s][e]+"\n":""}}return BattleText.default[e]?BattleText.default[e]+"\n":""},e.maybeAbility=function(e,t){return e&&e.startsWith("ability:")?this.ability(e.slice(8).trim(),t):""},e.ability=function(e,t){return e?BattleText.default.abilityActivation.replace("[POKEMON]",this.pokemon(t)).replace("[ABILITY]",this.effect(e))+"\n":""},u.stat=function(e){var t=BattleText[e||"stats"];return t&&t.statName?t.statName:"???stat:"+e+"???"},e.lineSection=function(e,t){var a=e[0];switch(a){case"done":case"turn":return"break";case"move":case"cant":case"switch":case"drag":case"upkeep":case"start":case"-mega":case"-candynamax":return"major";case"switchout":case"faint":return"preMajor";case"-zpower":return"postMajor";case"-damage":return"confusion"===u.effectId(t.from)?"major":"postMajor";case"-curestatus":return"naturalcure"===u.effectId(t.from)?"preMajor":"postMajor";case"-start":return"protean"===u.effectId(t.from)?"preMajor":"postMajor";case"-activate":var r=u.effectId(e[2]);return"confusion"===r||"attract"===r?"preMajor":"postMajor"}return"-"===a.charAt(0)?"postMajor":""},e.sectionBreak=function(e,t){var a=this.curLineSection,r=this.lineSection(e,t);if(!r)return!1;switch(this.curLineSection=r){case"break":return"break"!==a?!0:!1;case"preMajor":case"major":return"postMajor"===a||"major"===a?!0:!1;case"postMajor":return!1}},e.parseArgs=function(e,t,a){return(!a&&this.sectionBreak(e,t)?"\n":"")+this.fixLowercase(this.parseArgsInner(e,t)||"")},e.parseArgsInner=function(e,t){var a=e[0];switch(a){case"player":var r=e[1],i=e[2];return"p1"===r&&i?this.p1=i:"p2"===r&&i?this.p2=i:"p3"===r&&i?this.p3=i:"p4"===r&&i&&(this.p4=i),"";case"gen":r=e[1];return this.gen=parseInt(r,10),"";case"turn":i=e[1];return this.turn=Number.parseInt(i,10),this.template("turn").replace("[NUMBER]",i)+"\n";case"start":return this.template("startBattle").replace("[TRAINER]",this.p1).replace("[TRAINER]",this.p2);case"win":case"tie":r=e[1];return"tie"!==a&&r?this.template("winBattle").replace("[TRAINER]",r):this.template("tieBattle").replace("[TRAINER]",this.p1).replace("[TRAINER]",this.p2);case"switch":i=e[1],r=e[2],i=this.pokemonFull(i,r),r=i[0],i=i[1];return this.template("switchIn",this.own(r)).replace("[TRAINER]",this.trainer(r)).replace("[FULLNAME]",i);case"drag":r=e[1],i=e[2],r=this.pokemonFull(r,i),i=r[0],r=r[1];return this.template("drag").replace("[TRAINER]",this.trainer(i)).replace("[FULLNAME]",r);case"detailschange":case"-transform":case"-formechange":var i=e[1],s=e[2],o=e[3],c="";switch(a){case"detailschange":c=s.split(",")[0].trim();break;case"-transform":c=o;break;case"-formechange":c=s}var r=toID(c),l="",n="transform";if("-transform"!==a)switch(r){case"greninjaash":l="battlebond";break;case"mimikyubusted":l="disguise";break;case"zygardecomplete":l="powerconstruct";break;case"necrozmaultra":l="ultranecroziumz";break;case"darmanitanzen":l="zenmode";break;case"darmanitan":l="zenmode",n="transformEnd";break;case"darmanitangalarzen":l="zenmode";break;case"darmanitangalar":l="zenmode",n="transformEnd";break;case"aegislashblade":l="stancechange";break;case"aegislash":l="stancechange",n="transformEnd";break;case"wishiwashischool":l="schooling";break;case"wishiwashi":l="schooling",n="transformEnd";break;case"miniormeteor":l="shieldsdown";break;case"minior":l="shieldsdown",n="transformEnd";break;case"eiscuenoice":l="iceface";break;case"eiscue":l="iceface",n="transformEnd"}else c&&(l="transform");r=this.template(n,l,t.msg?"":"NODEFAULT");return this.maybeAbility(t.from,t.of||i)+r.replace("[POKEMON]",this.pokemon(i)).replace("[SPECIES]",c);case"switchout":r=e[1],i=r.slice(0,2);return this.template("switchOut",t.from,this.own(i)).replace("[TRAINER]",this.trainer(i)).replace("[NICKNAME]",this.pokemonName(r)).replace("[POKEMON]",this.pokemon(r));case"faint":i=e[1];return this.template("faint").replace("[POKEMON]",this.pokemon(i));case"swap":r=e[1],i=e[2];return i&&isNaN(Number(i))?this.template("swap").replace("[POKEMON]",this.pokemon(r)).replace("[TARGET]",this.pokemon(i)):this.template("swapCenter").replace("[POKEMON]",this.pokemon(r));case"move":var i=e[1],r=e[2],p=this.maybeAbility(t.from,t.of||i),m=(t.zeffect&&(p=this.template("zEffect").replace("[POKEMON]",this.pokemon(i))),this.template("move",t.from));return p+m.replace("[POKEMON]",this.pokemon(i)).replace("[MOVE]",r);case"cant":p=e[1],m=e[2],i=e[3],r=this.template("cant",m,"NODEFAULT")||this.template(i?"cant":"cantNoMove");return this.maybeAbility(m,t.of||p)+r.replace("[POKEMON]",this.pokemon(p)).replace("[MOVE]",i);case"-candynamax":m=e[1],r=this.own(m),p="";return(p=1===this.turn&&!r?p:this.template("canDynamax",r)).replace("[TRAINER]",this.trainer(m));case"message":return e[1]+"\n";case"-start":var i=e[1],r=e[2],p=e[3],m=this.maybeAbility(r,i)||this.maybeAbility(t.from,t.of||i),h=u.effectId(r);return"typechange"===h?m+this.template("typeChange",t.from).replace("[POKEMON]",this.pokemon(i)).replace("[TYPE]",p).replace("[SOURCE]",this.pokemon(t.of)):"typeadd"===h?m+this.template("typeAdd",t.from).replace("[POKEMON]",this.pokemon(i)).replace("[TYPE]",p):h.startsWith("stockpile")?(f=h.slice(9),m+this.template("start","stockpile").replace("[POKEMON]",this.pokemon(i)).replace("[NUMBER]",f)):h.startsWith("perish")?(f=h.slice(6),m+this.template("activate","perishsong").replace("[POKEMON]",this.pokemon(i)).replace("[NUMBER]",f)):(f="start",t.already&&(f="alreadyStarted"),t.fatigue&&(f="startFromFatigue"),t.zeffect&&(f="startFromZEffect"),t.damage&&(f="activate"),t.block&&(f="block"),t.upkeep&&(f="upkeep"),"mist"===h&&this.gen<=2&&(f="startGen"+this.gen),"start"===(f="reflect"!==h&&"lightscreen"!==h?f:"startGen1")&&null!=(h=t.from)&&h.startsWith("item:")&&(f+="FromItem"),m+this.template(f,r).replace("[POKEMON]",this.pokemon(i)).replace("[EFFECT]",this.effect(r)).replace("[MOVE]",p).replace("[SOURCE]",this.pokemon(t.of)).replace("[ITEM]",this.effect(t.from)));case"-end":var h=e[1],m=e[2],f=this.maybeAbility(m,h)||this.maybeAbility(t.from,t.of||h),i=u.effectId(m);return"doomdesire"===i||"futuresight"===i?f+this.template("activate",m).replace("[TARGET]",this.pokemon(h)):(r="",f+(r=(r=null!=(p=t.from)&&p.startsWith("item:")?this.template("endFromItem",m):r)||this.template("end",m)).replace("[POKEMON]",this.pokemon(h)).replace("[EFFECT]",this.effect(m)).replace("[SOURCE]",this.pokemon(t.of)).replace("[ITEM]",this.effect(t.from)));case"-ability":i=e[1],f=e[2],p=e[3],r=(e[4],"");return(p&&(p.startsWith("p1")||p.startsWith("p2")||"boost"===p)&&(p=""),p&&(r+=this.ability(p,i)),r+=this.ability(f,i),t.fail)?r+this.template("block",t.from):t.from?(r=this.maybeAbility(t.from,i)+r)+this.template("changeAbility",t.from).replace("[POKEMON]",this.pokemon(i)).replace("[ABILITY]",this.effect(f)).replace("[SOURCE]",this.pokemon(t.of)):"unnerve"===(h=u.effectId(f))?r+this.template("start",f).replace("[TEAM]",this.team(i.slice(0,2),!0)):(m="start",r+this.template(m="anticipation"!==h&&"sturdy"!==h?m:"activate",f,"NODEFAULT").replace("[POKEMON]",this.pokemon(i)));case"-endability":p=e[1],r=e[2];return r?this.ability(r,p):this.maybeAbility(t.from,t.of||p)+this.template("start","Gastro Acid").replace("[POKEMON]",this.pokemon(p));case"-item":h=e[1],m=e[2],f=u.effectId(t.from),i="",p=(["magician","pickpocket"].includes(f)&&(i=(r=[t.of,""])[0],t.of=r[1]),this.maybeAbility(t.from,t.of||h));return["thief","covet","bestow","magician","pickpocket"].includes(f)?p+this.template("takeItem",t.from).replace("[POKEMON]",this.pokemon(h)).replace("[ITEM]",this.effect(m)).replace("[SOURCE]",this.pokemon(i||t.of)):"frisk"===f?(r=t.of&&h&&t.of!==h,p+this.template(r?"activate":"activateNoTarget","Frisk").replace("[POKEMON]",this.pokemon(t.of)).replace("[ITEM]",this.effect(m)).replace("[TARGET]",this.pokemon(h))):t.from?p+this.template("addItem",t.from).replace("[POKEMON]",this.pokemon(h)).replace("[ITEM]",this.effect(m)):p+this.template("start",m,"NODEFAULT").replace("[POKEMON]",this.pokemon(h));case"-enditem":i=e[1],f=e[2],r=this.maybeAbility(t.from,t.of||i);return t.eat?r+this.template("eatItem",t.from).replace("[POKEMON]",this.pokemon(i)).replace("[ITEM]",this.effect(f)):"gem"===(p=u.effectId(t.from))?r+this.template("useGem",f).replace("[POKEMON]",this.pokemon(i)).replace("[ITEM]",this.effect(f)).replace("[MOVE]",t.move):"stealeat"===p?r+this.template("removeItem","Bug Bite").replace("[SOURCE]",this.pokemon(t.of)).replace("[ITEM]",this.effect(f)):t.from?r+this.template("removeItem",t.from).replace("[POKEMON]",this.pokemon(i)).replace("[ITEM]",this.effect(f)).replace("[SOURCE]",this.pokemon(t.of)):t.weaken?r+this.template("activateWeaken").replace("[POKEMON]",this.pokemon(i)).replace("[ITEM]",this.effect(f)):r+(this.template("end",f,"NODEFAULT")||this.template("activateItem").replace("[ITEM]",this.effect(f))).replace("[POKEMON]",this.pokemon(i)).replace("[TARGET]",this.pokemon(t.of));case"-status":m=e[1],h=e[2],p=this.maybeAbility(t.from,t.of||m);return"rest"===u.effectId(t.from)?p+this.template("startFromRest",h).replace("[POKEMON]",this.pokemon(m)):p+this.template("start",h).replace("[POKEMON]",this.pokemon(m));case"-curestatus":r=e[1],f=e[2];return"naturalcure"===u.effectId(t.from)?this.template("activate",t.from).replace("[POKEMON]",this.pokemon(r)):(i=this.maybeAbility(t.from,t.of||r),null!=(p=t.from)&&p.startsWith("item:")?i+this.template("endFromItem",f).replace("[POKEMON]",this.pokemon(r)).replace("[ITEM]",this.effect(t.from)):t.thaw?i+this.template("endFromMove",f).replace("[POKEMON]",this.pokemon(r)).replace("[MOVE]",this.effect(t.from)):i+(this.template("end",f,"NODEFAULT")||this.template("end").replace("[EFFECT]",f)).replace("[POKEMON]",this.pokemon(r)));case"-cureteam":return this.template("activate",t.from);case"-singleturn":case"-singlemove":h=e[1],m=e[2],p=this.maybeAbility(m,t.of||h)||this.maybeAbility(t.from,t.of||h);return"instruct"===u.effectId(m)?p+this.template("activate",m).replace("[POKEMON]",this.pokemon(t.of)).replace("[TARGET]",this.pokemon(h)):p+(this.template("start",m,"NODEFAULT")||this.template("start").replace("[EFFECT]",this.effect(m))).replace("[POKEMON]",this.pokemon(h)).replace("[SOURCE]",this.pokemon(t.of)).replace("[TEAM]",this.team(h.slice(0,2)));case"-sidestart":i=e[1],f=e[2];return(this.template("start",f,"NODEFAULT")||this.template("startTeamEffect").replace("[EFFECT]",this.effect(f))).replace("[TEAM]",this.team(i)).replace("[PARTY]",this.party(i));case"-sideend":r=e[1],p=e[2];return(this.template("end",p,"NODEFAULT")||this.template("endTeamEffect").replace("[EFFECT]",this.effect(p))).replace("[TEAM]",this.team(r)).replace("[PARTY]",this.party(r));case"-weather":m=e[1];return m&&"none"!==m?t.upkeep?this.template("upkeep",m,"NODEFAULT"):this.maybeAbility(t.from,t.of)+(this.template("start",m,"NODEFAULT")||this.template("startFieldEffect").replace("[EFFECT]",this.effect(m))):this.template("end",t.from,"NODEFAULT")||this.template("endFieldEffect").replace("[EFFECT]",this.effect(m));case"-fieldstart":case"-fieldactivate":h=e[1],f=this.maybeAbility(t.from,t.of),i=a.slice(6);return"perishsong"===u.effectId(h)&&(i="start"),f+(this.template(i,h,"NODEFAULT")||this.template("startFieldEffect").replace("[EFFECT]",this.effect(h))).replace("[POKEMON]",this.pokemon(t.of));case"-fieldend":p=e[1];return this.template("end",p,"NODEFAULT")||this.template("endFieldEffect").replace("[EFFECT]",this.effect(p));case"-sethp":r=t.from;return this.template("activate",r);case"-message":return"  "+e[1]+"\n";case"-hint":return"  ("+e[1]+")\n";case"-activate":m=e[1],f=e[2],i=e[3],h=u.effectId(f);if("celebrate"===h)return this.template("activate","celebrate").replace("[TRAINER]",this.trainer(m.slice(0,2)));!i&&["hyperspacefury","hyperspacehole","phantomforce","shadowforce","feint"].includes(h)&&(i=(p=[t.of,m])[1],m=(m=p[0])||i),i=i||t.of||m;r=this.maybeAbility(f,m);return"lockon"===h||"mindreader"===h?r+this.template("start",f).replace("[POKEMON]",this.pokemon(t.of)).replace("[SOURCE]",this.pokemon(m)):"mummy"===h&&t.ability?(r=(r+=this.ability(t.ability,i))+this.ability("Mummy",i))+this.template("changeAbility","mummy").replace("[TARGET]",this.pokemon(i)):(p="activate",(p=this.template(p="forewarn"===h&&m===i?"activateNoTarget":p,f,"NODEFAULT"))?("brickbreak"===h&&(p=p.replace("[TEAM]",this.team(i.slice(0,2)))),t.ability&&(r+=this.ability(t.ability,m)),t.ability2&&(r+=this.ability(t.ability2,i)),r+(p=t.move||t.number||t.item||t.name?p.replace("[MOVE]",t.move).replace("[NUMBER]",t.number).replace("[ITEM]",t.item).replace("[NAME]",t.name):p).replace("[POKEMON]",this.pokemon(m)).replace("[TARGET]",this.pokemon(i)).replace("[SOURCE]",this.pokemon(t.of))):r||r+(p=this.template("activate")).replace("[EFFECT]",this.effect(f)));case"-prepare":h=e[1],m=e[2],i=e[3];return this.template("prepare",m).replace("[POKEMON]",this.pokemon(h)).replace("[TARGET]",this.pokemon(i));case"-damage":r=e[1],p=e[3],f=this.template("damage",t.from,"NODEFAULT"),m=this.maybeAbility(t.from,t.of||r),h=u.effectId(t.from);if(!f){if(!t.from)return m+(f=this.template(p?"damagePercentage":"damage")).replace("[POKEMON]",this.pokemon(r)).replace("[PERCENTAGE]",p);if(t.from.startsWith("item:"))return m+(f=this.template(t.of?"damageFromPokemon":"damageFromItem")).replace("[POKEMON]",this.pokemon(r)).replace("[ITEM]",this.effect(t.from)).replace("[SOURCE]",this.pokemon(t.of));if(t.partiallytrapped||"bind"===h||"wrap"===h)return m+(f=this.template("damageFromPartialTrapping")).replace("[POKEMON]",this.pokemon(r)).replace("[MOVE]",this.effect(t.from));f=this.template("damage")}return m+f.replace("[POKEMON]",this.pokemon(r));case"-heal":i=e[1],p=this.template("heal",t.from,"NODEFAULT"),h=this.maybeAbility(t.from,i);return p?h+p.replace("[POKEMON]",this.pokemon(i)).replace("[SOURCE]",this.pokemon(t.of)).replace("[NICKNAME]",t.wisher):t.from&&!t.from.startsWith("ability:")?h+(p=this.template("healFromEffect")).replace("[POKEMON]",this.pokemon(i)).replace("[EFFECT]",this.effect(t.from)):h+(p=this.template("heal")).replace("[POKEMON]",this.pokemon(i));case"-boost":case"-unboost":m=e[1],f=e[2],r=e[3],h=("spa"===f&&1===this.gen&&(f="spc"),parseInt(r,10)),p=this.maybeAbility(t.from,t.of||m),i=a.slice(1);if(3<=h?i+="3":2<=h?i+="2":0===h&&(i+="0"),h&&t.zeffect)i+=t.multiple?"MultipleFromZEffect":"FromZEffect";else if(h&&null!=(r=t.from)&&r.startsWith("item:"))return p+this.template(i+"FromItem",t.from).replace("[POKEMON]",this.pokemon(m)).replace("[STAT]",u.stat(f)).replace("[ITEM]",this.effect(t.from));return p+this.template(i,t.from).replace("[POKEMON]",this.pokemon(m)).replace("[STAT]",u.stat(f));case"-setboost":h=e[1],r=t.from;return this.maybeAbility(r,t.of||h)+this.template("boost",r).replace("[POKEMON]",this.pokemon(h));case"-swapboost":p=e[1],i=e[2],m=this.maybeAbility(t.from,t.of||p),f=u.effectId(t.from),r="powerswap"===f?"swapOffensiveBoost":"guardswap"===f?"swapDefensiveBoost":"swapBoost";return m+this.template(r,t.from).replace("[POKEMON]",this.pokemon(p)).replace("[TARGET]",this.pokemon(i));case"-copyboost":h=e[1],f=e[2];return this.maybeAbility(t.from,t.of||h)+this.template("copyBoost",t.from).replace("[POKEMON]",this.pokemon(h)).replace("[TARGET]",this.pokemon(f));case"-clearboost":case"-clearpositiveboost":case"-clearnegativeboost":m=e[1],r=e[2],p=this.maybeAbility(t.from,t.of||m),i="clearBoost";return t.zeffect&&(i="clearBoostFromZEffect"),p+this.template(i,t.from).replace("[POKEMON]",this.pokemon(m)).replace("[SOURCE]",this.pokemon(r));case"-invertboost":h=e[1];return this.maybeAbility(t.from,t.of||h)+this.template("invertBoost",t.from).replace("[POKEMON]",this.pokemon(h));case"-clearallboost":return this.template("clearAllBoost",t.from);case"-crit":case"-supereffective":case"-resisted":f=e[1],p=a.slice(1);return"supereffective"===p&&(p="superEffective"),t.spread&&(p+="Spread"),this.template(p).replace("[POKEMON]",this.pokemon(f));case"-block":i=e[1],m=e[2],r=e[3],h=e[4],p=this.maybeAbility(m,t.of||i),f="block";return"mist"===u.effectId(m)&&this.gen<=2&&(f="blockGen"+this.gen),p+this.template(f,m).replace("[POKEMON]",this.pokemon(i)).replace("[SOURCE]",this.pokemon(h||t.of)).replace("[MOVE]",r);case"-fail":p=e[1],f=e[2],m=e[3],i=u.effectId(f),h=u.effectId(t.from),r=this.maybeAbility(t.from,t.of||p),f="block",h=(["desolateland","primordialsea"].includes(h)&&!["sunnyday","raindance","sandstorm","hail"].includes(i)?f="blockMove":"uproar"===h&&t.msg&&(f="blockSelf"),this.template(f,t.from));if(!h){if("unboost"===i)return r+(h=this.template(m?"failSingular":"fail","unboost")).replace("[POKEMON]",this.pokemon(p)).replace("[STAT]",m);f="fail",["brn","frz","par","psn","slp","frb","drw","substitute"].includes(i)&&(f="alreadyStarted"),t.heavy&&(f="failTooHeavy"),t.weak&&(f="fail"),t.forme&&(f="failWrongForme"),h=this.template(f,i)}return r+h.replace("[POKEMON]",this.pokemon(p));case"-immune":m=e[1],f=this.maybeAbility(t.from,t.of||m),i=this.template("block",t.from);return i||(r=t.ohko?"immuneOHKO":"immune",i=this.template(m?r:"immuneNoPokemon",t.from)),f+i.replace("[POKEMON]",this.pokemon(m));case"-miss":h=e[1],p=e[2],r=this.maybeAbility(t.from,t.of||p);return p?r+this.template("miss").replace("[POKEMON]",this.pokemon(p)):r+this.template("missNoPokemon").replace("[SOURCE]",this.pokemon(h));case"-center":case"-ohko":case"-combine":return this.template(a.slice(1));case"-notarget":return this.template("noTarget");case"-mega":case"-primal":f=e[1],i=e[2],m=e[3],p="",r=a.slice(1),h=("Rayquaza"===i&&(p="dragonascent",r="megaNoItem"),!p&&"-mega"===a&&this.gen<7&&(r="megaGen6"),this.template(r=m||"-mega"!==a?r:"megaNoItem",p)),r=f.slice(0,2),p=this.pokemon(f);return"-mega"===a&&(h+=this.template("transformMega").replace("[POKEMON]",p).replace("[SPECIES]",i)),h.replace("[POKEMON]",p).replace("[ITEM]",m).replace("[TRAINER]",this.trainer(r));case"-zpower":f=e[1];return this.template("zPower").replace("[POKEMON]",this.pokemon(f));case"-burst":i=e[1];return this.template("activate","Ultranecrozium Z").replace("[POKEMON]",this.pokemon(i));case"-zbroken":h=e[1];return this.template("zBroken").replace("[POKEMON]",this.pokemon(h));case"-hitcount":p=e[2];return"1"===p?this.template("hitCountSingular"):this.template("hitCount").replace("[NUMBER]",p);case"-waiting":m=e[1],r=e[2];return this.template("activate","Water Pledge").replace("[POKEMON]",this.pokemon(m)).replace("[TARGET]",this.pokemon(r));case"-anim":return"";default:return null}},u}();"function"==typeof require&&(global.BattleTextParser=BattleTextParser);
