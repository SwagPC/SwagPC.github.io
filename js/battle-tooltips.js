var ModifiableValue=function(){function e(e,t,a){this.value=0,this.maxValue=0,this.comment=void 0,this.battle=void 0,this.pokemon=void 0,this.serverPokemon=void 0,this.itemName=void 0,this.abilityName=void 0,this.weatherName=void 0,this.isAccuracy=!1,this.comment=[],this.battle=e,this.pokemon=t,this.serverPokemon=a,this.itemName=Dex.items.get(a.item).name;var s=a.ability||(null==t?void 0:t.ability)||a.baseAbility;this.abilityName=Dex.abilities.get(s).name,this.weatherName=(Dex.moves.get(e.weather).exists?Dex.moves:Dex.abilities).get(e.weather).name}var t=e.prototype;return t.reset=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length?arguments[1]:void 0;this.value=e,this.maxValue=0,this.isAccuracy=!!t,this.comment=[]},t.tryItem=function(e){var t;return e===this.itemName&&(this.battle.hasPseudoWeather("Magic Room")?(this.comment.push(" ("+e+" suppressed by Magic Room)"),!1):null!=(t=this.pokemon)&&t.volatiles.embargo?(this.comment.push(" ("+e+" suppressed by Embargo)"),!1):!(this.tryAbility("Klutz")&&!["Macho Brace","Power Anklet","Power Band","Power Belt","Power Bracer","Power Lens","Power Weight"].includes(e))||(this.comment.push(" ("+e+" suppressed by Klutz)"),!1))},t.tryAbility=function(e){var t;return e===this.abilityName&&(null!=(t=this.pokemon)&&t.volatiles.gastroacid?(this.comment.push(" ("+e+" suppressed by Gastro Acid)"),!1):!(null==(t=this.pokemon)||!t.effectiveAbility(this.serverPokemon)))},t.tryWeather=function(e){if(!this.weatherName)return!1;if(e){if(e!==this.weatherName)return!1}else e=this.weatherName;for(var t=0,a=this.battle.sides;t<a.length;t++)for(var s=0,i=a[t].active;s<i.length;s++){var l=i[s];if(l&&["Air Lock","Cloud Nine"].includes(l.ability))return this.comment.push(" ("+e+" suppressed by "+l.ability+")"),!1}return!0},t.itemModify=function(e,t){return!!(t=t||this.itemName)&&(!!this.tryItem(t)&&this.modify(e,t))},t.abilityModify=function(e,t){return!!this.tryAbility(t)&&this.modify(e,t)},t.weatherModify=function(e,t,a){return!!(t=t||this.weatherName)&&(!!this.tryWeather(t)&&this.modify(e,a||t))},t.modify=function(e,t){return 0===e?(t&&this.comment.push(" ("+t+")"),this.value=0,!(this.maxValue=0)):(t&&this.comment.push(" ("+this.round(e)+"&times; from "+t+")"),this.value*=e,"Technician"===t&&60<this.maxValue||(this.maxValue*=e),!0)},t.set=function(e,t){return t&&this.comment.push(" ("+t+")"),this.value=e,!(this.maxValue=0)},t.setRange=function(e,t,a){return a&&this.comment.push(" ("+a+")"),this.value=e,this.maxValue=t,!0},t.round=function(e){return e?Number(e.toFixed(2)):0},t.toString=function(){var e=this.isAccuracy?this.value?this.round(this.value)+"%":"can't miss":this.value?""+this.round(this.value):"";return this.maxValue&&(e+=" to "+this.round(this.maxValue)+(this.isAccuracy?"%":"")),e+this.comment.join("")},e}(),BattleTooltips=function(){function M(e){var a=this;this.battle=void 0,this.clickTooltipEvent=function(e){M.isLocked&&(e.preventDefault(),e.stopImmediatePropagation())},this.holdLockTooltipEvent=function(e){M.isLocked&&M.hideTooltip();var t=e.currentTarget,t=(a.showTooltip(t),"mousedown"===e.type&&"BUTTON"===t.tagName?2:1);M.longTapTimeout=setTimeout(function(){M.longTapTimeout=0,a.lockTooltip()},M.LONG_TAP_DELAY*t)},this.showTooltipEvent=function(e){M.isLocked||a.showTooltip(e.currentTarget)},this.battle=e}M.hideTooltip=function(){M.elem&&(M.cancelLongTap(),M.elem.parentNode.removeChild(M.elem),M.elem=null,M.parentElem=null,M.isLocked=!1,$("#tooltipwrapper").removeClass("tooltip-locked"))},M.cancelLongTap=function(){M.longTapTimeout&&(clearTimeout(M.longTapTimeout),M.longTapTimeout=0)};var e=M.prototype;return e.lockTooltip=function(){M.elem&&!M.isLocked&&(M.isLocked=!0,M.isPressed&&($(M.parentElem).removeClass("pressed"),M.isPressed=!1),$("#tooltipwrapper").addClass("tooltip-locked"))},e.handleTouchEnd=function(e){M.cancelLongTap(),M.isLocked||M.hideTooltip()},e.listen=function(e){var t=this,a=$(e);a.on("mouseover",".has-tooltip",this.showTooltipEvent),a.on("click",".has-tooltip",this.clickTooltipEvent),a.on("focus",".has-tooltip",this.showTooltipEvent),a.on("mouseout",".has-tooltip",M.unshowTooltip),a.on("mousedown",".has-tooltip",this.holdLockTooltipEvent),a.on("blur",".has-tooltip",M.unshowTooltip),a.on("mouseup",".has-tooltip",M.unshowTooltip),a.on("touchstart",".has-tooltip",function(e){e.preventDefault(),t.holdLockTooltipEvent(e),M.parentElem||(M.parentElem=e.currentTarget),$(M.parentElem).addClass("pressed"),M.isPressed=!0}),a.on("touchend",".has-tooltip",function(e){e.preventDefault(),e.currentTarget===M.parentElem&&M.isPressed&&M.parentElem.click(),M.unshowTooltip()}),a.on("touchleave",".has-tooltip",M.unshowTooltip),a.on("touchcancel",".has-tooltip",M.unshowTooltip)},M.unshowTooltip=function(){M.isLocked||(M.isPressed&&($(M.parentElem).removeClass("pressed"),M.isPressed=!1),M.hideTooltip())},e.showTooltip=function(e){var t=(e.dataset.tooltip||"").split("|"),a=t[0],s=!!e.dataset.ownheight;switch(a){case"move":case"zmove":case"maxmove":var i=this.battle.dex.moves.get(t[1]),l=parseInt(t[2],10),o=this.battle.nearSide.active[l+this.battle.pokemonControlled*Math.floor(this.battle.mySide.n/2)],r=t[3]?this.battle.dex.moves.get(t[3]):void 0;if(o){var l=this.battle.myPokemon[l],n=this.showMoveTooltip(i,a,o,l,r);break}return!1;case"pokemon":i=parseInt(t[1],10),o=this.battle.sides[i],l=o.pokemon[parseInt(t[2],10)];if("illusion"===t[3]){n="";for(var h=l.getBaseSpecies().baseSpecies,c=1,p=0,d=o.pokemon;p<d.length;p++){var u=d[p];u.getBaseSpecies().baseSpecies===h&&(n+=this.showPokemonTooltip(u,null,!1,c),c++)}}else n=this.showPokemonTooltip(l);break;case"activepokemon":r=parseInt(t[1],10),i=this.battle.sides[+this.battle.sidesSwitched^r],o=parseInt(t[2],10),l=o,r=(1<=o&&2<this.battle.sides.length&&(--l,i=this.battle.sides[i.n+2]),i.active[o]),o=null;if(i===this.battle.mySide&&this.battle.myPokemon&&(o=this.battle.myPokemon[l]),i===this.battle.mySide.ally&&this.battle.myAllyPokemon&&(o=this.battle.myAllyPokemon[l]),!r)return!1;n=this.showPokemonTooltip(r,o,!0);break;case"switchpokemon":i=parseInt(t[1],10),l=this.battle.myPokemon[i];n=this.showPokemonTooltip(null,l);break;case"allypokemon":r=parseInt(t[1],10),o=this.battle.myAllyPokemon?this.battle.myAllyPokemon[r]:null;n=this.showPokemonTooltip(null,o);break;case"field":n=this.showFieldTooltip();break;default:Promise.resolve(new Error("unrecognized type")),n='<p class="message-error" style="white-space: pre-wrap">'+new Error("unrecognized type").stack+"</p>"}return this.placeTooltip(n,e,s,a),!0},e.placeTooltip=function(e,t,a,s){t?o=$(t):(o=this.battle.scene.$turn,a=!0);var i=o.offset().left,l=(o=a?o:o.parent()).offset().top,o=l+o.outerHeight(),i=Math.max(i-2,0),l=Math.max(l-5,0),r=$("#tooltipwrapper"),n=(r.length?r.removeClass("tooltip-locked"):(r=$('<div id="tooltipwrapper" role="tooltip"></div>'),$(document.body).append(r),r.on("click",function(e){try{if("Range"===window.getSelection().type)return}catch(e){}M.hideTooltip()})),r.css({left:i,top:l}),r.html(e='<div class="tooltipinner"><div class="tooltip tooltip-'+s+'">'+e+"</div></div>").appendTo(document.body),M.elem=r.find(".tooltip")[0],M.isLocked=!1,$(M.elem).outerHeight()),o=(l-n<1?((l=o+n+5)>document.documentElement.clientHeight&&(l=n+1),r.css("top",l)):l<75&&(l=o+n+5)<document.documentElement.clientHeight&&r.css("top",l),$(M.elem).outerWidth());return i>document.documentElement.clientWidth-o-2&&(i=document.documentElement.clientWidth-o-2,r.css("left",i)),M.parentElem=t||null,!0},e.hideTooltip=function(){M.hideTooltip()},e.getStatusZMoveEffect=function(t){var e;return t.zMove.effect in M.zMoveEffects?M.zMoveEffects[t.zMove.effect]:(e="",t.zMove.boost?Object.keys(t.zMove.boost).map(function(e){return BattleTextParser.stat(e)+" +"+t.zMove.boost[e]}).join(", "):e)},e.getMaxMoveFromType=function(e,t){return t&&e===(t=Dex.moves.get(t)).type?t:Dex.moves.get(M.maxMoveTable[e])},e.showMoveTooltip=function(e,t,a,s,i){var l="",o="",r=a.side.foe.active,n=("freeforall"===this.battle.gameType&&(r=[].concat(r,a.side.active).filter(function(e){return e!==a})),"(suppressed)"===a.ability&&(s.ability="(suppressed)"),toID(s.ability||a.ability||s.baseAbility)),h=this.battle.dex.items.get(s.item),c=new ModifiableValue(this.battle,a,s),p=this.getMoveType(e,c,i||"maxmove"===t),d=p[0],p=p[1];if("zmove"===t)if(h.zMoveFrom===e.name)e=this.battle.dex.moves.get(h.zMove);else if("Status"===e.category)e=new Move(e.id,"",Object.assign({},e,{name:"Z-"+e.name})),o=this.getStatusZMoveEffect(e);else{var h=M.zMoveTable[h.zMoveType],u=this.battle.dex.moves.get(h),h=e.zMove.basePower;if(!h&&e.id.startsWith("hiddenpower")&&(h=this.battle.dex.moves.get("hiddenpower").zMove.basePower),"weatherball"===e.id)switch(this.battle.weather){case"sunnyday":case"desolateland":u=this.battle.dex.moves.get(M.zMoveTable.Fire);break;case"raindance":case"primordialsea":u=this.battle.dex.moves.get(M.zMoveTable.Water);break;case"sandstorm":u=this.battle.dex.moves.get(M.zMoveTable.Rock);break;case"hail":u=this.battle.dex.moves.get(M.zMoveTable.Ice)}e=new Move(u.id,u.name,Object.assign({},u,{category:e.category,basePower:h}))}else"maxmove"===t&&(e="Status"===e.category?this.battle.dex.moves.get("Max Guard"):(h=this.getMaxMoveFromType(d,i),m=(["gmaxdrumsolo","gmaxfireball","gmaxhydrosnipe"].includes(h.id)?h:e.maxMove).basePower,new Move(h.id,h.name,Object.assign({},h,{category:e.category,basePower:m}))));var m,l=(l=(l+="<h2>"+e.name+"<br />")+Dex.getTypeIcon(d))+(" "+Dex.getCategoryIcon(p)+"</h2>"),h=!1;if("Status"!==p&&1<r.length){for(var f,y=null,g=!1,b=[],v=0,k=r;v<k.length;v++){var S=k[v];S&&(f=""+(c=this.getMoveBasePower(e,d,c,S)),(y=null===y?f:y)!==f&&(g=!0),b.push("Base power vs "+S.name+": "+f))}g&&(l+="<p>"+b.join("<br />")+"</p>",h=!0)}h||"Status"===p||(m=r[0]||r[1]||r[2],l+="<p>Base power: "+(c=this.getMoveBasePower(e,d,c,m))+"</p>");h=this.getMoveAccuracy(e,c);return"naturepower"===e.id&&(p=5<this.battle.gen?this.battle.hasPseudoWeather("Electric Terrain")?"Thunderbolt":this.battle.hasPseudoWeather("Grassy Terrain")?"Energy Ball":this.battle.hasPseudoWeather("Misty Terrain")?"Moonblast":this.battle.hasPseudoWeather("Psychic Terrain")?"Psychic":"Tri Attack":3<this.battle.gen?"Earthquake":"Swift",r=this.battle.dex.moves.get(p),l+="Calls "+Dex.getTypeIcon(this.getMoveType(r,c)[0])+" "+r.name),l+="<p>Accuracy: "+h+"</p>",o&&(l+="<p>Z-Effect: "+o+"</p>"),this.battle.hardcoreMode?l+='<p class="section">'+e.shortDesc+"</p>":(l+='<p class="section">',1<e.priority?l+="Nearly always moves first <em>(priority +"+e.priority+")</em>.</p><p>":e.priority<=-1?l+="Nearly always moves last <em>(priority &minus;"+-e.priority+")</em>.</p><p>":1===e.priority?l+="Usually moves first <em>(priority +"+e.priority+")</em>.</p><p>":"grassyglide"===e.id&&this.battle.hasPseudoWeather("Grassy Terrain")&&(l+="Usually moves first <em>(priority +1)</em>.</p><p>"),l+=(e.desc||e.shortDesc||"")+"</p>","doubles"===this.battle.gameType||"multi"===this.battle.gameType?"allAdjacent"===e.target?l+="<p>&#x25ce; Hits both foes and ally.</p>":"allAdjacentFoes"===e.target&&(l+="<p>&#x25ce; Hits both foes.</p>"):"triples"===this.battle.gameType?"allAdjacent"===e.target?l+="<p>&#x25ce; Hits adjacent foes and allies.</p>":"allAdjacentFoes"===e.target?l+="<p>&#x25ce; Hits adjacent foes.</p>":"any"===e.target&&(l+="<p>&#x25ce; Can target distant Pok&eacute;mon in Triples.</p>"):"freeforall"===this.battle.gameType&&("allAdjacent"===e.target||"allAdjacentFoes"===e.target?l+="<p>&#x25ce; Hits all foes.</p>":"adjacentAlly"===e.target&&(l+="<p>&#x25ce; Can target any foe in Free-For-All.</p>")),e.flags.defrost&&(l+='<p class="movetag">The user thaws out if it is frozen.</p>'),e.flags.protect||["self","allySide"].includes(e.target)||(l+='<p class="movetag">Not blocked by Protect <small>(and Detect, King\'s Shield, Spiky Shield)</small></p>'),e.flags.bypasssub&&(l+='<p class="movetag">Bypasses Substitute <small>(but does not break it)</small></p>'),e.flags.reflectable||["self","allySide"].includes(e.target)||"Status"!==e.category||(l+='<p class="movetag">&#x2713; Not bounceable <small>(can\'t be bounced by Magic Coat/Bounce)</small></p>'),e.flags.contact&&(l+='<p class="movetag">&#x2713; Contact <small>(triggers Iron Barbs, Spiky Shield, etc)</small></p>'),e.flags.sound&&(l+='<p class="movetag">&#x2713; Sound <small>(doesn\'t affect Soundproof pokemon)</small></p>'),e.flags.powder&&5<this.battle.gen&&(l+='<p class="movetag">&#x2713; Powder <small>(doesn\'t affect Grass, Overcoat, Safety Goggles)</small></p>'),e.flags.punch&&"ironfist"===n&&(l+='<p class="movetag">&#x2713; Fist <small>(boosted by Iron Fist)</small></p>'),e.flags.pulse&&"megalauncher"===n&&(l+='<p class="movetag">&#x2713; Pulse <small>(boosted by Mega Launcher)</small></p>'),e.flags.bite&&"strongjaw"===n&&(l+='<p class="movetag">&#x2713; Bite <small>(boosted by Strong Jaw)</small></p>'),(e.recoil||e.hasCrashDamage)&&"reckless"===n&&(l+='<p class="movetag">&#x2713; Recoil <small>(boosted by Reckless)</small></p>'),e.flags.bullet&&(l+='<p class="movetag">&#x2713; Bullet-like <small>(doesn\'t affect Bulletproof pokemon)</small></p>')),l},e.showPokemonTooltip=function(e,t,a,s){var i=this,l=e||t,o="",r="",n=l.gender,n=("M"!==n&&"F"!==n||(r=' <img src="'+Dex.fxPrefix+"gender-"+n.toLowerCase()+'.png" alt="'+n+'" width="7" height="10" class="pixelated" /> '),BattleLog.escapeHTML(l.name)),h=(l.speciesForme!==l.name&&(n+=" <small>("+BattleLog.escapeHTML(l.speciesForme)+")</small>"),100!==l.level?" <small>L"+l.level+"</small>":"");s&&1!==s||(o+="<h2>"+n+r+(s?"":h)+"<br />",null!=e&&e.volatiles.formechange&&(e.volatiles.transform?o+="<small>(Transformed into "+e.volatiles.formechange[1]+")</small><br />":o+="<small>(Changed forme: "+e.volatiles.formechange[1]+")</small><br />"),n=this.getPokemonTypes(l),e&&(e.volatiles.typechange||e.volatiles.typeadd)&&(o+="<small>(Type changed)</small><br />"),o=o+n.map(function(e){return Dex.getTypeIcon(e)}).join(" ")+"</h2>"),s&&(o+='<p class="section"><strong>Possible Illusion #'+s+"</strong>"+h+"</p>"),l.fainted?o+="<p><small>HP:</small> (fainted)</p>":this.battle.hardcoreMode?t&&(o+="<p><small>HP:</small> "+t.hp+"/"+t.maxhp+(l.status?' <span class="status '+l.status+'">'+l.status.toUpperCase()+"</span>":"")+"</p>"):(r="",t?r=" ("+t.hp+"/"+t.maxhp+")":48===l.maxhp&&(r=" <small>("+l.hp+"/"+l.maxhp+" pixels)</small>"),o+="<p><small>HP:</small> "+Pokemon.getHPText(l)+r+(l.status?' <span class="status '+l.status+'">'+l.status.toUpperCase()+"</span>":""),e&&("tox"===l.status?"Poison Heal"===l.ability||"Magic Guard"===l.ability?o+=" <small>Would take if ability removed: "+Math.floor(6.25*Math.min(e.statusData.toxicTurns+1,15))+"%</small>":o+=" Next damage: "+Math.floor(100/(e.volatiles.dynamax?32:16)*Math.min(e.statusData.toxicTurns+1,15))+"%":"slp"===l.status&&(o+=" Turns asleep: "+e.statusData.sleepTurns)),o+="</p>");var c,p,n="",h=(2<this.battle.gen&&!this.battle.tier.includes("Let's Go")&&(n=this.getPokemonAbilityText(e,t,a,!!s&&1<s)),"");if(t?(p=r="",null!=e&&e.prevItem&&(r="None",c=Dex.items.get(e.prevItem).name,p+=e.prevItemEffect?c+" was "+e.prevItemEffect:"was "+c),p=p&&" ("+p+")",(r=t.item?Dex.items.get(t.item).name:r)&&(h="<small>Item:</small> "+r+p)):e&&(c="",r=e.itemEffect||"",e.prevItem&&(c="None",r&&(r+="; "),p=Dex.items.get(e.prevItem).name,r+=e.prevItemEffect?p+" was "+e.prevItemEffect:"was "+p),r=r&&" ("+r+")",(c=l.item?Dex.items.get(l.item).name:c)&&(h="<small>Item:</small> "+c+r)),(n||h)&&(o=o+"<p>"+n,n&&h&&(o+=!a&&t?" / ":"</p><p>"),o=o+h+"</p>"),o+=this.renderStats(e,t,!a),t&&!a){o+='<p class="section">';for(var d=e||this.battle.findCorrespondingPokemon(l),u=0,m=t.moves;u<m.length;u++){var f=m[u],y="&#8226; "+Dex.moves.get(f).name;if(null!=d&&d.moveTrack)for(var g=0,b=d.moveTrack;g<b.length;g++){var v=b[g];if(y===v[0]){y=this.getPPUseText(v,!0);break}}o+=y+"<br />"}o+="</p>"}else if(!this.battle.hardcoreMode&&null!=e&&e.moveTrack.length){o+='<p class="section">';for(var k=0,S=e.moveTrack;k<S.length;k++){var M=S[k];o+=this.getPPUseText(M)+"<br />"}4<e.moveTrack.filter(function(e){var t=e[0];return"*"!==t.charAt(0)&&(!(t=i.battle.dex.moves.get(t)).isZ&&!t.isMax&&"Mimic"!==t.name)}).length&&(o+="(More than 4 moves is usually a sign of Illusion Zoroark/Zorua.) "),3===this.battle.gen&&(o+="(Pressure is not visible in Gen 3, so in certain situations, more PP may have been lost than shown here.) "),this.pokemonHasClones(e)&&(o+="(Your opponent has two indistinguishable PokÃ©mon, making it impossible for you to tell which one has which moves/ability/item.) "),o+="</p>"}return o},e.showFieldTooltip=function(){for(var e=this.battle.scene,t='<table style="border: 0; border-collapse: collapse; vertical-align: top; padding: 0; width: 100%"><tr>',a=!1,s=0,i=this.battle.sides;s<i.length;s++){var l=i[s],o=e.sideConditionsLeft(l,!0);o&&(a=!0),t+='<td><p class="section"><strong>'+BattleLog.escapeHTML(l.name)+"</strong>"+(o||"<br />(no conditions)")+"</p></td>"}t+="</tr><table>",a||(t="");var r=e.weatherLeft()||"(no weather)";return"<p>"+(t="<p>"+(r=r.startsWith("<br />")?r.slice(6):r)+"</p>"+t)+"</p>"},e.pokemonHasClones=function(e){var t=e.side;if(!t.battle.speciesClause)for(var a=0,s=t.pokemon;a<s.length;a++){var i=s[a];if(e!==i&&e.searchid===i.searchid)return!0}return!1},e.calculateModifiedStats=function(e,t){for(var a=Object.assign({},t.stats),s=e||t,i=null==e?void 0:e.volatiles.powertrick,l=0,o=Dex.statNamesExceptHP;l<o.length;l++){var r,n=o[l],h=n;i&&("atk"===n&&(h="def"),"def"===n&&(h="atk")),a[n]=t.stats[h],e&&(h=!e.boosts.spc||"spa"!==n&&"spd"!==n?n:"spc",(h=e.boosts[h])&&(r=[1,1.5,2,2.5,3,3.5,4],0<h?a[n]*=r[h]:(this.battle.gen<=2&&(r=[1,100/66,2,2.5,100/33,100/28,4]),a[n]/=r[-h]),a[n]=Math.floor(a[n])))}var c=toID(null!=(c=null==e?void 0:e.effectiveAbility(t))?c:t.ability||t.baseAbility);if(s.status&&(2<this.battle.gen&&"guts"===c?a.atk=Math.floor(1.5*a.atk):this.battle.gen<2&&"brn"===s.status&&(a.atk=Math.floor(.5*a.atk)),2<this.battle.gen&&"quickfeet"===c&&(a.spe=Math.floor(1.5*a.spe))),this.battle.gen<=1)for(var p=0,d=Dex.statNamesExceptHP;p<d.length;p++){var u=d[p];999<a[u]&&(a[u]=999)}else{var m=toID(t.item),f=["machobrace","poweranklet","powerband","powerbelt","powerbracer","powerlens","powerweight"],y=(("klutz"===c&&!f.includes(m)||this.battle.hasPseudoWeather("Magic Room")||null!=e&&e.volatiles.embargo)&&(m=""),Dex.species.get(t.speciesForme).baseSpecies),g=(null==e?void 0:e.volatiles.transform)&&null!=e&&null!=(g=e.volatiles.formechange)&&g[1]&&this.battle.gen<=4?this.battle.dex.species.get(e.volatiles.formechange[1]).baseSpecies:y,b=[];if("lightball"===m&&"Pikachu"===g&&4!==this.battle.gen&&(4<this.battle.gen&&(a.atk*=2),a.spa*=2),"thickclub"!==m||"Marowak"!==g&&"Cubone"!==g||(a.atk*=2),"Ditto"!==g||e&&"transform"in e.volatiles||("quickpowder"===m&&b.push(2),"metalpowder"===m&&(2===this.battle.gen?(a.def=Math.floor(1.5*a.def),a.spd=Math.floor(1.5*a.spd)):a.def*=2)),!(this.battle.gen<=2)){var v=this.battle.weather;if(v)e:for(var k=0,S=this.battle.sides;k<S.length;k++)for(var M=0,P=S[k].active;M<P.length;M++){var x=P[M];if(x&&["Air Lock","Cloud Nine"].includes(x.ability)){v="";break e}}if("choiceband"!==m||null!=e&&e.volatiles.dynamax||(a.atk=Math.floor(1.5*a.atk)),"purepower"!==c&&"hugepower"!==c||(a.atk*=2),"hustle"!==c&&("gorillatactics"!==c||null!=e&&e.volatiles.dynamax)||(a.atk=Math.floor(1.5*a.atk)),v&&(4<=this.battle.gen&&this.pokemonHasType(s,"Rock")&&"sandstorm"===v&&(a.spd=Math.floor(1.5*a.spd)),"sandrush"===c&&"sandstorm"===v&&b.push(2),"slushrush"===c&&"hail"===v&&b.push(2),"utilityumbrella"!==m)){if("sunnyday"===v||"desolateland"===v){"solarpower"===c&&(a.spa=Math.floor(1.5*a.spa));var T=null==e?void 0:e.side.active;if(T)for(var w=0;w<T.length;w++){var A=T[w];A&&!A.fainted&&"Flower Gift"===this.getAllyAbility(A)&&("Cherrim"===A.getSpecies().baseSpecies||this.battle.gen<=4)&&(a.atk=Math.floor(1.5*a.atk),a.spd=Math.floor(1.5*a.spd))}}"chlorophyll"!==c||"sunnyday"!==v&&"desolateland"!==v||b.push(2),"swiftswim"!==c||"raindance"!==v&&"primordialsea"!==v||b.push(2)}if("defeatist"===c&&t.hp<=t.maxhp/2&&(a.atk=Math.floor(.5*a.atk),a.spa=Math.floor(.5*a.spa)),e&&("slowstart"in e.volatiles&&(a.atk=Math.floor(.5*a.atk),b.push(.5)),"unburden"===c&&"itemremoved"in e.volatiles&&!m&&b.push(2)),"marvelscale"===c&&s.status&&(a.def=Math.floor(1.5*a.def)),"eviolite"===m&&Dex.species.get(s.speciesForme).evos&&(a.def=Math.floor(1.5*a.def),a.spd=Math.floor(1.5*a.spd)),"grasspelt"===c&&this.battle.hasPseudoWeather("Grassy Terrain")&&(a.def=Math.floor(1.5*a.def)),"surgesurfer"===c&&this.battle.hasPseudoWeather("Electric Terrain")&&b.push(2),"choicespecs"!==m||null!=e&&e.volatiles.dynamax||(a.spa=Math.floor(1.5*a.spa)),"deepseatooth"===m&&"Clamperl"===y&&(a.spa*=2),"souldew"===m&&this.battle.gen<=6&&("Latios"===y||"Latias"===y)&&(a.spa=Math.floor(1.5*a.spa),a.spd=Math.floor(1.5*a.spd)),e&&("plus"===c||"minus"===c)){var B=e.side.active;if(1<B.length)for(var D="plus"===c?"Plus":"Minus",E=0;E<B.length;E++){var F=B[E];if(F&&F!==e&&!F.fainted){F=this.getAllyAbility(F);if(!("Plus"!==F&&"Minus"!==F||this.battle.gen<=4&&F===D)){a.spa=Math.floor(1.5*a.spa);break}}}}"assaultvest"===m&&(a.spd=Math.floor(1.5*a.spd)),"deepseascale"===m&&"Clamperl"===y&&(a.spd*=2),"choicescarf"!==m||null!=e&&e.volatiles.dynamax||b.push(1.5),"ironball"!==m&&!f.includes(m)||b.push(.5),"furcoat"===c&&(a.def*=2);for(var g=this.battle.mySide.sideConditions,G=(g.tailwind&&b.push(2),g.grasspledge&&b.push(.25),1),W=0;W<b.length;W++)G*=b[W];a.spe=a.spe*G,a.spe=.5<a.spe%1?Math.ceil(a.spe):Math.floor(a.spe),"par"===s.status&&"quickfeet"!==c&&(6<this.battle.gen?a.spe=Math.floor(.5*a.spe):a.spe=Math.floor(.25*a.spe))}}return a},e.renderStats=function(e,t,a){var s=null==e?void 0:e.volatiles.transform;if(!t||s){if(e)return"<p><small>Spe</small> "+(s=this.getSpeedRange(e))[0]+" to "+s[1]+" <small>(before items/abilities/modifiers)</small></p>";throw new Error("Must pass either clientPokemon or serverPokemon")}var i=t.stats,l=this.calculateModifiedStats(e,t),o="<p>";if(!a){for(var r=!1,n=0,h=Dex.statNamesExceptHP;n<h.length;n++){var c,p=h[n];1===this.battle.gen&&"spd"===p||(c=1===this.battle.gen&&"spa"===p?"spc":p,o=(o=(o+="atk"===p?"<small>":"<small> / ")+BattleText[c].statShortName+"&nbsp;</small>")+i[p],l[p]!==i[p]&&(r=!0))}if(o+="</p>",!r)return o;o=o+"<p><small>(After stat modifiers:)</small></p>"+"<p>"}for(var d=0,u=Dex.statNamesExceptHP;d<u.length;d++){var m,f=u[d];1===this.battle.gen&&"spd"===f||(m=1===this.battle.gen&&"spa"===f?"spc":f,o=(o+="atk"===f?"<small>":"<small> / ")+BattleText[m].statShortName+"&nbsp;</small>",l[f]===i[f]?o+=""+l[f]:l[f]<i[f]?o+='<strong class="stat-lowered">'+l[f]+"</strong>":o+='<strong class="stat-boosted">'+l[f]+"</strong>")}return o+="</p>"},e.getPPUseText=function(e,t){var a,s,i=e[0],l=e[1],o=("*"===i.charAt(0)?(a=this.battle.dex.moves.get(i.substr(1)),s=5):(s=1===(a=this.battle.dex.moves.get(i)).pp||a.noPPBoosts?a.pp:8*a.pp/5,this.battle.gen<3&&(s=Math.min(61,s))),"*"===i.charAt(0)||a.isZ?'<span style="color:#888">&#8226;</span>':"&#8226;");return l===1/0?o+" "+a.name+" <small>(0/"+s+")</small>":l||"*"===i.charAt(0)?o+" "+a.name+" <small>("+(s-l)+"/"+s+")</small>":o+" "+a.name+" "+(t?" <small>(revealed)</small>":"")},e.ppUsed=function(e,t){for(var a=0,s=t.moveTrack;a<s.length;a++){var i=s[a],l=i[0],i=i[1];if("*"===l.charAt(0)&&(l=l.substr(1)),e.name===l)return i}return 0},e.getSpeedRange=function(e){var t,a,s=(e=e.volatiles.transform?e.volatiles.transform[1]:e).level,i=e.getSpecies().baseStats.spe,l=this.battle.tier,o=this.battle.gen,r=l.includes("Random Battle")||l.includes("Random")&&l.includes("Battle")&&6<=o,n=r||o<3?1:.9,h=r||o<3?1:1.1,c=o<3?30:31,p=Math.trunc||Math.floor;return l.includes("Let's Go")?(t=p(p(p(2*i*s/100+5)*n)*p(100*(70/255/10+1))/100),a=p(p(p((2*i+c)*s/100+5)*h)*p(100*(70/255/10+1))/100),l.includes("No Restrictions")?a+=200:l.includes("Random")&&(a+=20)):(l=c+(r&&3<=o?21:63),t=p(p(2*i*s/100+5)*n),a=p(p((2*i+l)*s/100+5)*h)),[t,a]},e.getMoveType=function(e,t,a){var s=t.pokemon,i=t.serverPokemon,l=e.type,o=e.category;if("Status"===o&&a)return["Normal","Status"];if(s){var r=s.getTypeList(i),n=(t.reset(),"revelationdance"===e.id&&(l=r[0]),Dex.items.get(t.itemName));if("multiattack"===e.id&&n.onMemory&&t.itemModify(0)&&(l=n.onMemory),"judgment"===e.id&&n.onPlate&&!n.zMoveType&&t.itemModify(0)&&(l=n.onPlate),"technoblast"===e.id&&n.onDrive&&t.itemModify(0)&&(l=n.onDrive),"naturalgift"===e.id&&n.naturalGift&&t.itemModify(0)&&(l=n.naturalGift.type),"weatherball"===e.id&&t.weatherModify(0))switch(this.battle.weather){case"sunnyday":case"desolateland":"utilityumbrella"!==n.id&&(l="Fire");break;case"raindance":case"primordialsea":"utilityumbrella"!==n.id&&(l="Water");break;case"sandstorm":l="Rock";break;case"hail":l="Ice"}"terrainpulse"===e.id&&s.isGrounded(i)&&(this.battle.hasPseudoWeather("Electric Terrain")?l="Electric":this.battle.hasPseudoWeather("Grassy Terrain")?l="Grass":this.battle.hasPseudoWeather("Misty Terrain")?l="Fairy":this.battle.hasPseudoWeather("Psychic Terrain")&&(l="Psychic")),"aurawheel"===e.id&&"Morpeko-Hangry"===s.getSpeciesForme()&&(l="Dark");r=!["judgment","multiattack","naturalgift","revelationdance","struggle","technoblast","terrainpulse","weatherball"].includes(e.id),i=(!r||"Status"===o||e.isZ||e.id.startsWith("hiddenpower")||("Normal"===l&&(t.abilityModify(0,"Aerilate")&&(l="Flying"),t.abilityModify(0,"Galvanize")&&(l="Electric"),t.abilityModify(0,"Pixilate")&&(l="Fairy"),t.abilityModify(0,"Refrigerate")&&(l="Ice")),t.abilityModify(0,"Normalize")&&(l="Normal")),!!(a?this.getMaxMoveFromType(l,!0!==a&&a||void 0):e).flags.sound);r&&i&&t.abilityModify(0,"Liquid Voice")&&(l="Water"),this.battle.gen<=3&&"Status"!==o&&(o=Dex.getGen3Category(l))}return[l,o]},e.getMoveAccuracy=function(e,t,a){t.reset(!0===e.accuracy?0:e.accuracy,!0);var s=t.pokemon;if("toxic"===e.id&&6<=this.battle.gen&&this.pokemonHasType(s,"Poison"))t.set(0,"Poison type");else if("blizzard"===e.id&&t.weatherModify(0,"Hail"),"hurricane"!==e.id&&"thunder"!==e.id||(t.weatherModify(0,"Rain Dance"),t.weatherModify(0,"Primordial Sea")),t.abilityModify(0,"No Guard"),t.value)if(e.ohko)1===this.battle.gen?t.set(t.value,"fails if target's Speed is higher"):("sheercold"===e.id&&7<=this.battle.gen&&!this.pokemonHasType(s,"Ice")&&t.set(20,"not Ice-type"),a?s.level<a.level?(t.reset(0),t.set(0,"FAILS: target's level is higher")):s.level>a.level&&t.set(t.value+s.level-a.level,"+1% per level above target"):(s.level<100&&t.set(t.value,"fails if target's level is higher"),1<s.level&&t.set(t.value,"+1% per level above target")));else{var i=[];this.battle.hasPseudoWeather("Gravity")&&(i.push(6840),t.modify(5/3,"Gravity"));for(var l=0,o=s.side.active;l<o.length;l++){var r=o[l];r&&!r.fainted&&"Victory Star"===this.getAllyAbility(r)&&(i.push(4506),t.modify(1.1,"Victory Star"))}t.tryAbility("Hustle")&&"Physical"===e.category?(i.push(3277),t.abilityModify(.8,"Hustle")):t.tryAbility("Compound Eyes")&&(i.push(5325),t.abilityModify(1.3,"Compound Eyes")),t.tryItem("Wide Lens")&&(i.push(4505),t.itemModify(1.1,"Wide Lens"));for(var n=4096,h=0;h<i.length;h++){var c=i[h];4096!==c&&(n=n*c+2048>>12)}t.set(e.accuracy),"hurricane"!==e.id&&"thunder"!==e.id||(t.tryWeather("Sunny Day")&&t.set(50,"Sunny Day"),t.tryWeather("Desolate Land")&&t.set(50,"Desolate Land"));var p=.5<(p=t.value*n/4096)%1?Math.ceil(p):Math.floor(p);t.set(p),null!=s&&s.boosts.accuracy&&(0<s.boosts.accuracy?t.set(Math.floor(t.value*(s.boosts.accuracy+3)/3)):t.set(Math.floor(3*t.value/(3-s.boosts.accuracy)))),1!==this.battle.gen||toID(this.battle.tier).includes("stadium")||t.set(Math.floor(255*t.value/100)/256*100)}return t},e.getMoveBasePower=function(e,t,a){var s,i,l,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=a.pokemon,n=a.serverPokemon,h=this.calculateModifiedStats(r,n);if(a.reset(e.basePower),"acrobatics"!==e.id||n.item||a.modify(2,"Acrobatics + no item"),["crushgrip","wringout"].includes(e.id)&&o&&a.set(Math.floor(Math.floor((100*Math.floor(4096*o.hp/o.maxhp)*120+2048-1)/4096)/100)||1,"approximate"),"brine"===e.id&&o&&2*o.hp<=o.maxhp&&a.modify(2,"Brine + target below half HP"),"eruption"!==e.id&&"waterspout"!==e.id&&"dragonenergy"!==e.id||a.set(Math.floor(150*r.hp/r.maxhp)||1),"facade"!==e.id||["","slp","frz"].includes(r.status)||a.modify(2,"Facade + status"),"flail"!==e.id&&"reversal"!==e.id||(s=4<this.battle.gen?(i=48,[2,5,10,17,33]):(i=64,[2,6,13,22,43]),i=(i=r.hp*i/r.maxhp)<s[0]?200:i<s[1]?150:i<s[2]?100:i<s[3]?80:i<s[4]?40:20,a.set(i)),"hex"===e.id&&null!=o&&o.status&&a.modify(2,"Hex + status"),"punishment"===e.id&&o){for(var c=0,p=0,d=Object.values(o.boosts);p<d.length;p++){var u=d[p];0<u&&(c+=u)}a.set(Math.min(60+20*c,200))}if("smellingsalts"===e.id&&o&&"par"===o.status&&a.modify(2,"Smelling Salts + Paralysis"),["storedpower","powertrip"].includes(e.id)&&o){for(var m=0,f=0,y=Object.values(r.boosts);f<y.length;f++){var g=y[f];0<g&&(m+=g)}a.set(20+20*m)}if("trumpcard"===e.id&&(s=40,1==(i=5-this.ppUsed(e,r))?s=200:2==i?s=80:3==i?s=60:4==i&&(s=50),a.set(s)),"magnitude"===e.id&&a.setRange(10,150),"venoshock"===e.id&&o&&["psn","tox"].includes(o.status)&&a.modify(2,"Venoshock + Poison"),"wakeupslap"===e.id&&o&&"slp"===o.status&&a.modify(2,"Wake-Up Slap + Sleep"),"weatherball"===e.id&&"deltastream"!==this.battle.weather&&a.weatherModify(2),"terrainpulse"===e.id&&r.isGrounded(n)&&(this.battle.hasPseudoWeather("Electric Terrain")||this.battle.hasPseudoWeather("Grassy Terrain")||this.battle.hasPseudoWeather("Misty Terrain")||this.battle.hasPseudoWeather("Psychic Terrain"))&&a.modify(2,"Terrain Pulse boost"),"watershuriken"===e.id&&"Greninja-Ash"===r.getSpeciesForme()&&"Battle Bond"===r.ability&&a.set(20,"Battle Bond"),"electroball"===e.id&&o&&(s=(i=this.getSpeedRange(o))[0],i=i[1],i=h.spe/i,s=h.spe/s,a.setRange(4<=i?150:3<=i?120:2<=i?80:1<=i?60:40,4<=s?150:3<=s?120:2<=s?80:1<=s?60:40)),"gyroball"===e.id&&o&&(s=(i=this.getSpeedRange(o))[0],i=i[1],150<(s=Math.floor(25*s/h.spe)||1)&&(s=150),i=Math.floor(25*i/h.spe)||1,a.setRange(s,i=150<i?150:i)),n.item&&(h=Dex.items.get(n.item),"fling"===e.id&&h.fling&&a.itemModify(h.fling.basePower),"naturalgift"===e.id&&a.itemModify(h.naturalGift.basePower)),["lowkick","grassknot","heavyslam","heatcrash"].includes(e.id)&&(s=["lowkick","grassknot"].includes(e.id),o?(i=o.getWeightKg(),h=r.getWeightKg(n),s?(l=20,200<=i?l=120:100<=i?l=100:50<=i?l=80:25<=i?l=60:10<=i&&(l=40)):(l=40,5*i<=h?l=120:4*i<=h?l=100:3*i<=h?l=80:2*i<=h&&(l=60)),o.volatiles.dynamax?a.set(0,"blocked by target's Dynamax"):a.set(l)):a.setRange(s?20:40,120)),a.value){"brn"===r.status&&"Special"===e.category&&a.abilityModify(1.5,"Flare Boost"),e.flags.pulse&&a.abilityModify(1.5,"Mega Launcher"),e.flags.bite&&a.abilityModify(1.5,"Strong Jaw"),a.value<=60&&a.abilityModify(1.5,"Technician"),["psn","tox"].includes(r.status)&&"Physical"===e.category&&a.abilityModify(1.5,"Toxic Boost"),2<this.battle.gen&&"brn"===n.status&&"facade"!==e.id&&"Physical"===e.category&&(a.tryAbility("Guts")||a.modify(.5,"Burn")),2<this.battle.gen&&"frb"===n.status&&"Special"===e.category&&a.modify(.5,"Frostbite"),["Rock","Ground","Steel"].includes(t)&&"sandstorm"===this.battle.weather&&a.tryAbility("Sand Force")&&a.weatherModify(1.3,"Sandstorm","Sand Force"),e.secondaries&&a.abilityModify(1.3,"Sheer Force"),e.flags.contact&&a.abilityModify(1.3,"Tough Claws"),"Steel"===t&&a.abilityModify(1.5,"Steely Spirit"),e.flags.sound&&a.abilityModify(1.3,"Punk Rock"),o&&(["MF","FM"].includes(r.gender+o.gender)?a.abilityModify(.75,"Rivalry"):["MM","FF"].includes(r.gender+o.gender)&&a.abilityModify(1.25,"Rivalry"));if("Status"===e.category||["judgment","multiattack","naturalgift","revelationdance","struggle","technoblast","terrainpulse","weatherball"].includes(e.id)||e.isZ||e.isMax||e.id.startsWith("hiddenpower")||("Normal"===e.type&&(a.abilityModify(6<this.battle.gen?1.2:1.3,"Aerilate"),a.abilityModify(6<this.battle.gen?1.2:1.3,"Galvanize"),a.abilityModify(6<this.battle.gen?1.2:1.3,"Pixilate"),a.abilityModify(6<this.battle.gen?1.2:1.3,"Refrigerate")),6<this.battle.gen&&a.abilityModify(1.2,"Normalize")),e.flags.punch&&a.abilityModify(1.2,"Iron Fist"),(e.recoil||e.hasCrashDamage)&&a.abilityModify(1.2,"Reckless"),"Status"!==e.category){for(var b="",v=!1,k=0,S=r.side.active;k<S.length;k++){var M,P=S[k];P&&!P.fainted&&(M=this.getAllyAbility(P),"Fairy"===t&&"Fairy Aura"===M?b="Fairy Aura":"Dark"===t&&"Dark Aura"===M?b="Dark Aura":"Aura Break"===M?v=!0:"Battery"===M?P!==r&&"Special"===e.category&&a.modify(1.3,"Battery"):"Power Spot"===M&&P!==r&&a.modify(1.3,"Power Spot"))}for(var x=0,T=r.side.foe.active;x<T.length;x++){var w=T[x];w&&!w.fainted&&("Fairy Aura"===w.ability?"Fairy"===t&&(b="Fairy Aura"):"Dark Aura"===w.ability?"Dark"===t&&(b="Dark Aura"):"Aura Break"===w.ability&&(v=!0))}b&&(v?a.modify(.75,b+" + Aura Break"):a.modify(1.33,b))}this.battle.hasPseudoWeather("Electric Terrain")&&"Electric"===t||this.battle.hasPseudoWeather("Grassy Terrain")&&"Grass"===t||this.battle.hasPseudoWeather("Psychic Terrain")&&"Psychic"===t?r.isGrounded(n)&&a.modify(7<this.battle.gen?1.3:1.5,"Terrain boost"):this.battle.hasPseudoWeather("Misty Terrain")&&"Dragon"===t?o&&!o.isGrounded()||a.modify(.5,"Misty Terrain + grounded target"):this.battle.hasPseudoWeather("Grassy Terrain")&&["earthquake","bulldoze","magnitude"].includes(e.id)&&(o&&!o.isGrounded()||a.modify(.5,"Grassy Terrain + grounded target")),"expandingforce"===e.id&&this.battle.hasPseudoWeather("Psychic Terrain")&&r.isGrounded(n)&&a.modify(1.5,"Expanding Force + Psychic Terrain boost"),"mistyexplosion"===e.id&&this.battle.hasPseudoWeather("Misty Terrain")&&a.modify(1.5,"Misty Explosion + Misty Terrain boost"),"risingvoltage"===e.id&&this.battle.hasPseudoWeather("Electric Terrain")&&null!=o&&o.isGrounded()&&a.modify(2,"Rising Voltage + Electric Terrain boost"),"steelroller"!==e.id||this.battle.hasPseudoWeather("Electric Terrain")||this.battle.hasPseudoWeather("Grassy Terrain")||this.battle.hasPseudoWeather("Misty Terrain")||this.battle.hasPseudoWeather("Psychic Terrain")||a.set(0,"no Terrain"),a=this.getItemBoost(e,a,t)}return a},e.getItemBoost=function(e,t,a){var s=this.battle.dex.items.get(t.serverPokemon.item),i=s.name,l=e.name,o=this.battle.dex.species.get(t.serverPokemon.speciesForme),r=(t.pokemon.volatiles.transform&&null!=(r=t.pokemon.volatiles.formechange)&&r[1]&&this.battle.gen<=4?this.battle.dex.species.get(t.pokemon.volatiles.formechange[1]):o).baseSpecies;return s.onPlate!==a||s.zMove?M.incenseTypes[s.name]===a?t.itemModify(1.2):M.itemTypes[s.name]===a?t.itemModify(this.battle.gen<4?1.1:1.2):"Light Ball"===s.name&&4===this.battle.gen&&"Pikachu"===r?t.itemModify(2):"Soul Dew"===s.name&&this.battle.gen<7||(M.orbUsers[r]===s.name&&[M.orbTypes[s.name],"Dragon"].includes(a)?t.itemModify(1.2):M.noGemMoves.includes(l)||i===a+" Gem"&&t.itemModify(this.battle.gen<6?1.5:1.3)):t.itemModify(1.2),t},e.getPokemonTypes=function(e){return e.getTypes?e.getTypeList():this.battle.dex.species.get(e.speciesForme).types},e.pokemonHasType=function(e,t,a){for(var s=0,i=a=a||this.getPokemonTypes(e);s<i.length;s++)if(i[s]===t)return!0;return!1},e.getAllyAbility=function(e){var t=Dex.abilities.get(e.ability).name;return t||(this.battle.myAllyPokemon?t=Dex.abilities.get(this.battle.myAllyPokemon[e.slot].ability).name:this.battle.myPokemon&&(t=Dex.abilities.get(this.battle.myPokemon[e.slot].ability).name)),t},e.getPokemonAbilityData=function(e,t){var a,s={ability:"",baseAbility:"",possibilities:[]};return e&&(e.ability?(s.ability=e.ability||e.baseAbility,e.baseAbility&&(s.baseAbility=e.baseAbility)):(a=e.getSpeciesForme()||(null==t?void 0:t.speciesForme)||"",(a=this.battle.dex.species.get(a)).exists&&a.abilities&&(s.possibilities=[a.abilities[0]],a.abilities[1]&&s.possibilities.push(a.abilities[1]),a.abilities.H&&s.possibilities.push(a.abilities.H),a.abilities.S&&s.possibilities.push(a.abilities.S)))),t&&(s.ability||(s.ability=t.ability||t.baseAbility),!s.baseAbility&&t.baseAbility&&(s.baseAbility=t.baseAbility)),s},e.getPokemonAbilityText=function(e,t,a,s){var i,l,o="",r=this.getPokemonAbilityData(e,t);return a?r.ability&&(o="<small>Ability:</small> "+(l=Dex.abilities.get(r.ability).name),(i=Dex.abilities.get(r.baseAbility).name)&&i!==l&&(o+=" (base: "+i+")")):(l=r.baseAbility||r.ability)&&(o="<small>Ability:</small> "+Dex.abilities.get(l).name),o=o||!r.possibilities.length||s?o:"<small>Possible abilities:</small> "+r.possibilities.join(", ")},M}(),BattleStatGuesser=(BattleTooltips.LONG_TAP_DELAY=350,BattleTooltips.longTapTimeout=0,BattleTooltips.elem=null,BattleTooltips.parentElem=null,BattleTooltips.isLocked=!1,BattleTooltips.isPressed=!1,BattleTooltips.zMoveEffects={clearnegativeboost:"Restores negative stat stages to 0",crit2:"Crit ratio +2",heal:"Restores HP 100%",curse:"Restores HP 100% if user is Ghost type, otherwise Attack +1",redirect:"Redirects opposing attacks to user",healreplacement:"Restores replacement's HP 100%"},BattleTooltips.zMoveTable={Poison:"Acid Downpour",Fighting:"All-Out Pummeling",Dark:"Black Hole Eclipse",Grass:"Bloom Doom",Normal:"Breakneck Blitz",Rock:"Continental Crush",Steel:"Corkscrew Crash",Dragon:"Devastating Drake",Electric:"Gigavolt Havoc",Water:"Hydro Vortex",Fire:"Inferno Overdrive",Ghost:"Never-Ending Nightmare",Bug:"Savage Spin-Out",Psychic:"Shattered Psyche",Ice:"Subzero Slammer",Flying:"Supersonic Skystrike",Ground:"Tectonic Rage",Fairy:"Twinkle Tackle","???":""},BattleTooltips.maxMoveTable={Poison:"Max Ooze",Fighting:"Max Knuckle",Dark:"Max Darkness",Grass:"Max Overgrowth",Normal:"Max Strike",Rock:"Max Rockfall",Steel:"Max Steelspike",Dragon:"Max Wyrmwind",Electric:"Max Lightning",Water:"Max Geyser",Fire:"Max Flare",Ghost:"Max Phantasm",Bug:"Max Flutterby",Psychic:"Max Mindstorm",Ice:"Max Hailstorm",Flying:"Max Airstream",Ground:"Max Quake",Fairy:"Max Starfall","???":""},BattleTooltips.incenseTypes={"Odd Incense":"Psychic","Rock Incense":"Rock","Rose Incense":"Grass","Sea Incense":"Water","Wave Incense":"Water"},BattleTooltips.itemTypes={"Black Belt":"Fighting","Black Glasses":"Dark",Charcoal:"Fire","Dragon Fang":"Dragon","Hard Stone":"Rock",Magnet:"Electric","Metal Coat":"Steel","Miracle Seed":"Grass","Mystic Water":"Water","Never-Melt Ice":"Ice","Poison Barb":"Poison","Sharp Beak":"Flying","Silk Scarf":"Normal","Silver Powder":"Bug","Soft Sand":"Ground","Spell Tag":"Ghost","Twisted Spoon":"Psychic"},BattleTooltips.orbUsers={Latias:"Soul Dew",Latios:"Soul Dew",Dialga:"Adamant Orb",Palkia:"Lustrous Orb",Giratina:"Griseous Orb"},BattleTooltips.orbTypes={"Soul Dew":"Psychic","Adamant Orb":"Steel","Lustrous Orb":"Water","Griseous Orb":"Ghost"},BattleTooltips.noGemMoves=["Fire Pledge","Fling","Grass Pledge","Struggle","Water Pledge"],function(){function e(e){this.formatid=void 0,this.dex=void 0,this.moveCount=null,this.hasMove=null,this.ignoreEVLimits=void 0,this.supportsEVs=void 0,this.supportsAVs=void 0,this.formatid=e,this.dex=e?Dex.mod(e.slice(0,4)):Dex,this.ignoreEVLimits=this.dex.gen<3||this.formatid.endsWith("hackmons")&&6!==this.dex.gen||this.formatid.includes("metronomebattle")||this.formatid.endsWith("norestrictions"),this.supportsEVs=!this.formatid.includes("letsgo"),this.supportsAVs=!this.supportsEVs&&this.formatid.endsWith("norestrictions")}var t=e.prototype;return t.guess=function(e){var t,a=this.guessRole(e),s=this.guessEVs(e,a),i={hp:0,atk:0,def:0,spa:0,spd:0,spe:0};for(t in i)i[t]=s[t]||0;return{role:a,evs:i,plusStat:s.plusStat||"",minusStat:s.minusStat||"",moveCount:this.moveCount,hasMove:this.hasMove}},t.guessRole=function(e){if(!e)return"?";if(!e.moves)return"?";var t={Physical:0,Special:0,PhysicalAttack:0,SpecialAttack:0,PhysicalSetup:0,SpecialSetup:0,Support:0,Setup:0,Restoration:0,Offense:0,Stall:0,SpecialStall:0,PhysicalStall:0,Fast:0,Ultrafast:0,bulk:0,specialBulk:0,physicalBulk:0},a={},s=toID(e.item),i=this.dex.items.get(s),l=toID(e.ability),o=this.dex.species.get(e.species||e.name);if(!(o=i.megaEvolves===o.name?this.dex.species.get(i.megaStone):o).exists)return"?";i=o.baseStats;if(e.moves.length<1)return"?";var r=!["unown","ditto"].includes(o.id);if(e.moves.map(toID).includes("lastresort")&&(r=!1),e.moves.length<4&&r&&"gen8metronomebattle"!==this.formatid)return"?";for(var n=0,h=e.moves.length;n<h;n++){var c=this.dex.moves.get(e.moves[n]);a[c.id]=1,"Status"===c.category?["batonpass","healingwish","lunardance"].includes(c.id)?t.Support++:["metronome","assist","copycat","mefirst","photongeyser","shellsidearm"].includes(c.id)?(t.Physical+=.5,t.Special+=.5):"naturepower"===c.id?t.Special++:["protect","detect","spikyshield","kingsshield"].includes(c.id)?t.Stall++:"wish"===c.id?(t.Restoration++,t.Stall++,t.Support++):c.heal?(t.Restoration++,t.Stall++):"self"===c.target?(["agility","rockpolish","shellsmash","growth","workup"].includes(c.id)?(t.PhysicalSetup++,t.SpecialSetup++):["dragondance","swordsdance","coil","bulkup","curse","bellydrum"].includes(c.id)?t.PhysicalSetup++:["nastyplot","tailglow","quiverdance","calmmind","geomancy"].includes(c.id)&&t.SpecialSetup++,"substitute"===c.id&&t.Stall++,t.Setup++):(["toxic","leechseed","willowisp"].includes(c.id)&&t.Stall++,t.Support++):["counter","endeavor","metalburst","mirrorcoat","rapidspin"].includes(c.id)?t.Support++:["nightshade","seismictoss","psywave","superfang","naturesmadness","foulplay","endeavor","finalgambit","bodypress"].includes(c.id)?t.Offense++:"fellstinger"===c.id?(t.PhysicalSetup++,t.Setup++):(t[c.category]++,t.Offense++,"knockoff"===c.id&&t.Support++,["scald","voltswitch","uturn","flipturn"].includes(c.id)&&(t[c.category]-=.2))}a.batonpass&&(t.Support+=t.Setup),t.PhysicalAttack=t.Physical,t.Physical+=t.PhysicalSetup,t.SpecialAttack=t.Special,t.Special+=t.SpecialSetup,(a.dragondance||a.quiverdance)&&(t.Ultrafast=1);var r=80<=i.spe,p=(i.hp+75)*(i.def+87),d=(i.hp+75)*(i.spd+87),u=(a.willowisp||a.acidarmor||a.irondefense||a.cottonguard?(p*=1.6,t.PhysicalStall++):(a.scald||a.bulkup||a.coil||a.cosmicpower)&&(p*=1.3,a.scald?t.SpecialStall++:t.PhysicalStall++),"flamebody"===l&&(p*=1.1),(a.calmmind||a.quiverdance||a.geomancy)&&(d*=1.3,t.SpecialStall++),"sandstream"===l&&o.types.includes("Rock")&&(d*=1.5),a.bellydrum&&(p*=.6,d*=.6),t.Restoration?(p*=1.5,d*=1.5):a.painsplit&&a.substitute?t.Stall--:(a.painsplit||a.rest)&&(p*=1.4,d*=1.4),((a.bodyslam||a.thunder)&&"serenegrace"===l||a.thunderwave)&&(p*=1.1,d*=1.1),(a.ironhead||a.airslash)&&"serenegrace"===l&&(p*=1.1,d*=1.1),(a.gigadrain||a.drainpunch||a.hornleech)&&(p*=1.15,d*=1.15),"leftovers"!==s&&"blacksludge"!==s||(p*=1+.1*(1+t.Stall/1.5),d*=1+.1*(1+t.Stall/1.5)),a.leechseed&&(p*=1+.1*(1+t.Stall/1.5),d*=1+.1*(1+t.Stall/1.5)),"flameorb"!==s&&"toxicorb"!==s||"magicguard"===l||("toxicorb"===s&&"poisonheal"===l?(p*=1+.1*(2+t.Stall),d*=1+.1*(2+t.Stall)):(p*=.8,d*=.8)),"lifeorb"===s&&(p*=.7,d*=.7),"multiscale"!==l&&"magicguard"!==l&&"regenerator"!==l||(p*=1.4,d*=1.4),"eviolite"===s&&(p*=1.5,d*=1.5),"assaultvest"===s&&(d*=1.5),p+d);if(u<46e3&&70<=i.spe&&(r=!0),a.trickroom&&(r=!1),t.bulk=u,t.physicalBulk=p,t.specialBulk=d,a.agility||a.dragondance||a.quiverdance||a.rockpolish||a.shellsmash||a.flamecharge?r=!0:"unburden"===l||"speedboost"===l||"motordrive"===l?(r=!0,t.Ultrafast=1):"chlorophyll"===l||"swiftswim"===l||"sandrush"===l?(r=!0,t.Ultrafast=2):"salacberry"===s&&(r=!0),(a.agility||a.shellsmash||a.autotomize||a.shiftgear||a.rockpolish)&&(t.Ultrafast=2),t.Fast=r?1:0,this.moveCount=t,this.hasMove=a,"ditto"===o.id)return"imposter"===l?"Physically Defensive":"Fast Bulky Support";if("shedinja"===o.id)return"Fast Physical Sweeper";if("choiceband"===s&&2<=t.PhysicalAttack)return r?"Fast Band":"Bulky Band";if("choicespecs"===s&&2<=t.SpecialAttack)return r?"Fast Specs":"Bulky Specs";if("choicescarf"===s)return 0===t.PhysicalAttack?"Special Scarf":0===t.SpecialAttack?"Physical Scarf":!(t.PhysicalAttack>t.SpecialAttack)&&(t.PhysicalAttack<t.SpecialAttack||i.atk<i.spa)?"Special Biased Mixed Scarf":"Physical Biased Mixed Scarf";if("unown"===o.id)return"Fast Special Sweeper";if(t.PhysicalStall&&t.Restoration)return 110<i.spe&&"prankster"!==l?"Fast Bulky Support":"Specially Defensive";if(t.SpecialStall&&t.Restoration&&"lifeorb"!==s)return 110<i.spe&&"prankster"!==l?"Fast Bulky Support":"Physically Defensive";s="Physical";if(i.spa>i.atk&&1<t.Special?s="Special":i.atk>i.spa&&1<t.Physical?s="Physical":t.Special>t.Physical&&(s="Special"),t.Stall+t.Support/2<=2&&u<135e3&&1.5<=t[s]){if(r)return 8e4<u&&!t.Ultrafast?"Bulky "+s+" Sweeper":"Fast "+s+" Sweeper";if(3<=t[s]||t.Stall<=0)return"Bulky "+s+" Sweeper"}return r&&"prankster"!==l&&(100<i.spe||u<55e3||t.Ultrafast)?"Fast Bulky Support":!t.SpecialStall&&(t.PhysicalStall||"blissey"!==o.id&&"chansey"!==o.id&&p<=d)?"Specially Defensive":"Physically Defensive"},t.ensureMinEVs=function(e,t,a,s){e[t]||(e[t]=0);var i,l=a-e[t];if(!(l<=0)&&(s<=504&&(s+=i=Math.min(508-s,l),e[t]+=i,l-=i),!(l<=0)))for(var o in{def:1,spd:1,hp:1,atk:1,spa:1,spe:1})if(o!==t&&e[o]&&128<e[o])return e[o]-=l,e[t]+=l,s;return s},t.ensureMaxEVs=function(e,t,a,s){e[t]||(e[t]=0);var i=e[t]-a;return i<=0||(e[t]-=i,s-=i),s},t.guessEVs=function(e,t){if(!e)return{};if("?"===t)return{};var a=this.dex.species.get(e.species||e.name),s=a.baseStats,i=this.hasMove,l=this.moveCount,o={hp:0,atk:0,def:0,spa:0,spd:0,spe:0},r="",n="",h={"Bulky Band":["atk","hp"],"Fast Band":["spe","atk"],"Bulky Specs":["spa","hp"],"Fast Specs":["spe","spa"],"Physical Scarf":["spe","atk"],"Special Scarf":["spe","spa"],"Physical Biased Mixed Scarf":["spe","atk"],"Special Biased Mixed Scarf":["spe","spa"],"Fast Physical Sweeper":["spe","atk"],"Fast Special Sweeper":["spe","spa"],"Bulky Physical Sweeper":["atk","hp"],"Bulky Special Sweeper":["spa","hp"],"Fast Bulky Support":["spe","hp"],"Physically Defensive":["def","hp"],"Specially Defensive":["spd","hp"]},r=h[t][0];if("Fast Bulky Support"===t&&(l.Ultrafast=0),"spe"===r&&l.Ultrafast&&(r="atk"===h[t][1]||"spa"===h[t][1]?h[t][1]:3<=l.Physical?"atk":s.spd>s.def?"spd":"def"),this.supportsAVs)o={hp:200,atk:200,def:200,spa:200,spd:200,spe:200},l.PhysicalAttack||(o.atk=0),l.SpecialAttack||(o.spa=0),(i.gyroball||i.trickroom)&&(o.spe=0);else if(this.supportsEVs)if(this.ignoreEVLimits){if(o={hp:252,atk:252,def:252,spa:252,spd:252,spe:252},l.PhysicalAttack||(o.atk=0),!l.SpecialAttack&&1<this.dex.gen&&(o.spa=0),(i.gyroball||i.trickroom)&&(o.spe=0),1===this.dex.gen&&(o.spd=0),this.dex.gen<3)return o}else{if(!h[t])return{};for(var c=0,p=h[t][0],d=this.getStat(p,e,252,r===p?1.1:1),u=252;0<u&&d<=this.getStat(p,e,u-4,r===p?1.1:1);)u-=4;c+=o[p]=u;var m=h[t][1];for("hp"===m&&e.level&&e.level<20&&(m="spd"),d=this.getStat(m,e,252,r===m?1.1:1),u=252;0<u&&d<=this.getStat(m,e,u-4,r===m?1.1:1);)u-=4;c+=o[m]=u;var h=["Fire","Flying","Bug","Ice"],f=["Ground","Steel","Fighting"],y=0,g=("Magic Guard"!==e.ability&&"Mountaineer"!==e.ability&&(0<=h.indexOf(a.types[0])?y++:0<=f.indexOf(a.types[0])&&y--,0<=h.indexOf(a.types[1])?y++:0<=f.indexOf(a.types[1])&&y--),0),b=!1,v=o.hp||0,d=this.getStat("hp",e,v,1);if("Leftovers"!==e.item&&"Black Sludge"!==e.item||!i.substitute||404===d?"Leftovers"===e.item||"Black Sludge"===e.item?g=0:i.bellydrum&&"Berry"===(e.item||"").slice(-5)?(g=2,b=!0):i.substitute&&"Berry"===(e.item||"").slice(-5)?(g=4,b=!0):2<=y||i.bellydrum?g=2:1<=y||i.substitute||i.transform?g=4:"Magic Guard"!==e.ability&&(g=8):g=4,g){for(;v<252&&c<508&&!(d%g)!==b;)d=this.getStat("hp",e,v+=4,1),c+=4;for(;0<v&&!(d%g)!==b;)d=this.getStat("hp",e,v-=4,1),c-=4;for(;0<v&&d===this.getStat("hp",e,v-4,1);)v-=4,c-=4;(v||o.hp)&&(o.hp=v)}if("tentacruel"===a.id?c=this.ensureMinEVs(o,"spe",16,c):"skarmory"===a.id?c=this.ensureMinEVs(o,"spe",24,c):"jirachi"===a.id?c=this.ensureMinEVs(o,"spe",32,c):"celebi"===a.id?c=this.ensureMinEVs(o,"spe",36,c):"volcarona"===a.id?c=this.ensureMinEVs(o,"spe",52,c):"gliscor"===a.id?c=this.ensureMinEVs(o,"spe",72,c):"dragonite"===a.id&&o.hp&&(c=this.ensureMaxEVs(o,"spe",220,c)),c<508){h=508-c;if(252<h&&(h=252),m=null,!o.atk&&1<=l.PhysicalAttack?m="atk":!o.spa&&1<=l.SpecialAttack?m="spa":1!==s.hp||o.def?(s.def!==s.spd||o.spd)&&o.spd?o.def||(m="def"):m="spd":m="def",m){for(u=h,d=this.getStat(m,e,u);0<u&&d===this.getStat(m,e,u-4);)u-=4;u&&(o[m]=u),h-=u}if(h&&!o.spe){for(u=h,d=this.getStat("spe",e,u);0<u&&d===this.getStat("spe",e,u-4);)u-=4;u&&(o.spe=u)}}}return i.gyroball||i.trickroom?n="spe":l.PhysicalAttack?l.SpecialAttack<1&&!o.spa?l.SpecialAttack<l.PhysicalAttack?n="spa":o.atk||(n="atk"):n=l.PhysicalAttack<1&&!o.atk?"atk":s.def>s.spe&&s.spd>s.spe&&!o.spe?"spe":s.def>s.spd?"spd":"def":n="atk",r===n&&(n="spe"===r?"spd":"spe"),o.plusStat=r,o.minusStat=n,o},t.getStat=function(e,t,a,s){var i,l,o,r,n=this.dex.species.get(t.species);return n.exists?(i=t.level||100,n=n.baseStats[e],"number"!=typeof(l=t.ivs&&t.ivs[e])&&(l=31),this.dex.gen<=2&&(l&=30),"number"!=typeof(o=t.evs&&t.evs[e])&&(o=2<this.dex.gen?0:252),void 0!==a&&(o=a),"hp"===e?1===n?1:this.supportsEVs?~~(~~(2*n+l+~~(o/4)+100)*i/100+10):~~(~~(2*n+l+100)*i/100+10)+(this.supportsAVs?o:0):(r=~~(~~(2*n+l+~~(o/4))*i/100+5),this.supportsEVs||(r=~~(~~(2*n+l)*i/100+5)),s?r*=s:(null==(n=BattleNatures[t.nature])?void 0:n.plus)===e?r*=1.1:(null==(l=BattleNatures[t.nature])?void 0:l.minus)===e&&(r*=.9),this.supportsEVs||(r=102*~~r/100+(this.supportsAVs?o:0)),~~r)):0},e}());"function"==typeof require&&(global.BattleStatGuesser=BattleStatGuesser);
